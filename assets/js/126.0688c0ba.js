(window.webpackJsonp=window.webpackJsonp||[]).push([[126],{413:function(s,a,n){"use strict";n.r(a);var t=n(10),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"本地部署minigpt4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本地部署minigpt4"}},[s._v("#")]),s._v(" 本地部署minigpt4")]),s._v(" "),a("h2",{attrs:{id:"_1、下载代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、下载代码"}},[s._v("#")]),s._v(" 1、下载代码")]),s._v(" "),a("p",[s._v("代码地址 "),a("a",{attrs:{href:"https://github.com/Vision-CAIR/MiniGPT-4",target:"_blank",rel:"noopener noreferrer"}},[s._v("MiniGPT-4"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"_2、下载模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、下载模型"}},[s._v("#")]),s._v(" 2、下载模型")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://huggingface.co/Vision-CAIR/vicuna-7b/tree/main",target:"_blank",rel:"noopener noreferrer"}},[s._v("vicuna-7b"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("配置模型位置，修改配置文件 "),a("code",[s._v("minigpt4\\configs\\models\\minigpt4_vicuna0.yaml")]),s._v("，第 18 行修改 "),a("code",[s._v("llama_model")]),s._v(" 地址")]),s._v(" "),a("h2",{attrs:{id:"_3、下载模型检查点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、下载模型检查点"}},[s._v("#")]),s._v(" 3、下载模型检查点")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://drive.google.com/file/d/1RY9jV0dyqLX-o38LrumkKRh6Jtaop58R/view?usp=sharing",target:"_blank",rel:"noopener noreferrer"}},[s._v("vicuna-7b检查点"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("配置检查点位置，修改配置文件 "),a("code",[s._v("\\eval_configs\\minigpt4_eval.yaml")]),s._v("，第 8 行修改 "),a("code",[s._v("ckpt")]),s._v(" 地址")]),s._v(" "),a("h2",{attrs:{id:"_4、配置环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、配置环境"}},[s._v("#")]),s._v(" 4、配置环境")]),s._v(" "),a("h3",{attrs:{id:"_4-1-安装-conda"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-安装-conda"}},[s._v("#")]),s._v(" 4.1 安装 conda")]),s._v(" "),a("p",[a("code",[s._v("wget https://mirrors.bfsu.edu.cn/anaconda/archive/Anaconda3-2023.09-0-Linux-x86_64.sh --no-check-certificate")])]),s._v(" "),a("h3",{attrs:{id:"_4-2-创建虚拟环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-创建虚拟环境"}},[s._v("#")]),s._v(" 4.2 创建虚拟环境")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("conda create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" minigpt4 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("python")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.8")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cuda 11.4 使用 python=3.8")]),s._v("\nconda activate minigpt4 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入虚拟环境")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_4-3-安装pip依赖库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-安装pip依赖库"}},[s._v("#")]),s._v(" 4.3 安装pip依赖库")]),s._v(" "),a("p",[s._v("进入虚拟环境后，开始安装pip依赖库")]),s._v(" "),a("p",[s._v("创建 requirements.txt 文件，输入如下内容：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("torchaudio\nhuggingface-hub==0.18.0\nmatplotlib==3.7.0\npsutil==5.9.4\niopath\npyyaml==6.0\nregex==2022.10.31\ntokenizers==0.13.2\ntqdm==4.64.1\ntransformers==4.30.0\ntimm==0.6.13\nwebdataset==0.2.48\nomegaconf==2.3.0\nopencv-python==4.7.0.72\npeft==0.2.0\nsentence-transformers\ngradio==3.47.1\naccelerate==0.20.3\nwandb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("输入命令开始安装："),a("code",[s._v("pip install -r requirements.txt -i https://mirror.sjtu.edu.cn/pypi/web/simple")])]),s._v(" "),a("p",[s._v("单独安装的库：")]),s._v(" "),a("ul",[a("li",[s._v("torch==2.1.0 (arm平台需要单独下载安装)")]),s._v(" "),a("li",[s._v("scikit-image")]),s._v(" "),a("li",[s._v("visual_genome")])]),s._v(" "),a("p",[s._v("编译安装的库：")]),s._v(" "),a("ul",[a("li",[s._v("torchvision (arm平台需要编译并安装)")]),s._v(" "),a("li",[s._v("decord==0.6.0 (arm平台需要编译并安装)")]),s._v(" "),a("li",[s._v("bitsandbytes==0.37.0 (arm平台需要安装)")])]),s._v(" "),a("p",[s._v("安装 decord：（arm orin）")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libjpeg-dev zlib1g-dev libpython3-dev libopenblas-dev libavcodec-dev libavformat-dev libswscale-dev ffmpeg libavfilter-dev libavutil-dev\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载 decord 编译")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--recursive")]),s._v(" https://github.com/dmlc/decord\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" decord\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" build\ncmake "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-DCMAKE_BUILD_TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Release\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/python\npython3 setup.py "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--user")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("安装 bitsandbytes：（orin）")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pip install bitsandbytes orin 系统会报错")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# git clone https://github.com/timdettmers/bitsandbytes.git #官方链接存在问题无法编译")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/g588928812/bitsandbytes_jetsonX\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" bitsandbytes\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CUDA_VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" cuda11x  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 切少文件解决参见https://blog.csdn.net/xwb_12340/article/details/130268747")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pip3 uninstall bitsandbytes #卸载之前安装的错误版本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" python3 setup.py "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("安装 torch：（orin）")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://developer.download.nvidia.cn/compute/redist/jp/v512/pytorch/torch-2.1.0a0+41361538.nv23.06-cp38-cp38-linux_aarch64.whl\npip3 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" torch-2.1.0a0+41361538.nv23.06-cp38-cp38-linux_aarch64.whl\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("安装 torchvision：（orin）")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-b")]),s._v(" v0.16.0 https://github.com/pytorch/vision torchvision\ncmake "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\npython3 setup.py "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--user")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_5、添加-swap-虚拟内存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、添加-swap-虚拟内存"}},[s._v("#")]),s._v(" 5、添加 swap 虚拟内存")]),s._v(" "),a("p",[s._v("如果内存不足可以添加 swap 虚拟内存")]),s._v(" "),a("p",[s._v("方法一：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 swap 分区")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /swap\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/zero "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("of")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/swap/swapfile "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1M "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkswap")]),s._v(" /swap/swapfile  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 建立swap的文件系统")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /swap/swapfile  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改权限")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("swapon")]),s._v(" /swap/swapfile  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启用swap文件")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使系统开机时自启用，在文件/etc/fstab中添加一行")]),s._v("\n/swap/swapfile swap swap defaults "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前交换分区路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("swapon")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看当前内存使用情况")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-mt")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("方法二：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1、以root身份进入控制台（登录系统），停止所有的swap分区")]),s._v("\nswapoff "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2、对新添加磁盘进行分区 用fdisk命令（例：# fdisk /dev/sdb）对磁盘进行分区，添加swap分区，新建分区，在fdisk中用“t”命令将新添的分区id改为82（Linux swap类型），最后用w将操作实际写入硬盘（没用w之前的操作是无效的）。")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3、格式化swap分区 这里的sdb2要看您加完后p命令显示的实际分区设备名")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkswap")]),s._v(" /dev/sdb2\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4、启动新的swap分区")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("swapon")]),s._v(" /dev/sdb2\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5、为了让系统启动时能自动启用这个交换分区，可以编辑/etc/fstab,加入下面一行")]),s._v("\n/dev/sdb2 swap swap defaults "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h2",{attrs:{id:"_6、配置-huggingface-transformers-使用本地模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、配置-huggingface-transformers-使用本地模型"}},[s._v("#")]),s._v(" 6、配置 huggingface transformers 使用本地模型")]),s._v(" "),a("p",[s._v("设置环境变量")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HF_DATASETS_OFFLINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TRANSFORMERS_OFFLINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("修改模型的 "),a("code",[s._v("config.json")]),s._v(" 文件 "),a("code",[s._v("_name_or_path")]),s._v(" 地址改为模型地址")]),s._v(" "),a("h2",{attrs:{id:"_7、配置-bert-base-uncased-模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、配置-bert-base-uncased-模型"}},[s._v("#")]),s._v(" 7、配置 bert-base-uncased 模型")]),s._v(" "),a("p",[a("code",[s._v("git clone https://huggingface.co/bert-base-uncased/tree/main")])]),s._v(" "),a("p",[s._v("修改文件 "),a("code",[s._v("\\minigpt4\\models\\minigpt4.py")]),s._v(" 第 89 行：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('encoder_config = BertConfig.from_pretrained("bert-base-uncased") # 改为本地 bert-base-uncased 模型地址\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_8、启动配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8、启动配置"}},[s._v("#")]),s._v(" 8、启动配置")]),s._v(" "),a("p",[s._v("修改 "),a("code",[s._v("demo.py")]),s._v(" 文件：")]),s._v(" "),a("p",[a("code",[s._v("demo.launch(server_name='0.0.0.0', share=True, enable_queue=True)")])]),s._v(" "),a("p",[s._v("启动之前可以查看运行状态："),a("code",[s._v("jtop")])]),s._v(" "),a("p",[s._v("启动命令：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对于 MiniGPT-v2，运行")]),s._v("\npython demo_v2.py --cfg-path eval_configs/minigptv2_eval.yaml  --gpu-id "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对于 MiniGPT-4（Vicuna 版本），运行")]),s._v("\npython demo.py --cfg-path eval_configs/minigpt4_eval.yaml  --gpu-id "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对于 MiniGPT-4（Llama2 版本），运行")]),s._v("\npython demo.py --cfg-path eval_configs/minigpt4_llama2_eval.yaml  --gpu-id "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("运行后提示 "),a("code",[s._v("Running on local URL: http://0.0.0.0:7860")]),s._v(" 表示已成功启动")]),s._v(" "),a("h2",{attrs:{id:"_9、常见问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9、常见问题"}},[s._v("#")]),s._v(" 9、常见问题")]),s._v(" "),a("h3",{attrs:{id:"_9-1-gradio-frpc-linux-问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-gradio-frpc-linux-问题"}},[s._v("#")]),s._v(" 9.1 gradio frpc_linux 问题")]),s._v(" "),a("p",[s._v("提示如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Could not create share link. Missing file: /home/vvt/anaconda3/envs/minigpt4/lib/python3.8/site-packages/gradio/frpc_linux_aarch64_v0.2. \n\nPlease check your internet connection. This can happen if your antivirus software blocks the download of this file. You can install manually by following these steps: \n\n1. Download this file: https://cdn-media.huggingface.co/frpc-gradio-0.2/frpc_linux_aarch64\n2. Rename the downloaded file to: frpc_linux_aarch64_v0.2\n3. Move the file to this location: /home/xxx/anaconda3/envs/minigpt4/lib/python3.8/site-packages/gradio\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("下载文件 "),a("code",[s._v("https://github.com/lvyufeng/frpc-gradio")]),s._v(" "),a("code",[s._v("frpc_linux_arm64")]),s._v(" 重命名为 "),a("code",[s._v("frpc_linux_aarch64_v0.2")]),s._v("，并复制到目录")]),s._v(" "),a("h3",{attrs:{id:"_9-2-bitsandbytes-库报错-libbitsandbytes-cpu-so-undefined-symbol-cget-col-row-stats"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-bitsandbytes-库报错-libbitsandbytes-cpu-so-undefined-symbol-cget-col-row-stats"}},[s._v("#")]),s._v(" 9.2 bitsandbytes 库报错：libbitsandbytes_cpu.so: undefined symbol: cget_col_row_stats")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("AttributeError: /xxx/.conda/envs/luxuntest/lib/python3.8/site-packages/bitsandbytes/libbitsandbytes_cpu.so: undefined symbol: cget_col_row_stats\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("将 libbitsandbytes_cpu.so 替换成 GPU 的 so")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /home/xxx/.conda/envs/xxx/lib/python3.x/site-packages/bitsandbytes\ncp libbitsandbytes_cuda1xx.so libbitsandbytes_cpu.so\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("具体使用哪个版本的 _cudaxxx.so 根据 torch_gpu 对应的 cuda 版本而定")]),s._v(" "),a("h2",{attrs:{id:"_10、jeson-orin-nx-运行-minigpt4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10、jeson-orin-nx-运行-minigpt4"}},[s._v("#")]),s._v(" 10、jeson orin nx 运行 minigpt4")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.jetson-ai-lab.com/tutorial_minigpt4.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考地址"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("运行命令：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1、下载 jetson-containers 代码")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/dusty-nv/jetson-containers\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" jetson-containers\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" python3-pip\npip3 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" requirements.txt\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2、设置可执行文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x autotag\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x run.sh\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3、复制大模型文件到 data 目录")]),s._v("\n./data/models/huggingface/datasets--maknee--ggml-vicuna-v0-quantized/snapshots/1d8789f34eb803bf52daf895c7ecfd2559cf5ccc/ggml-vicuna-7B-v0-q5_k.bin\n./data/models/huggingface/datasets--maknee--minigpt4-7b-ggml/snapshots/79340163b5a9a37908610cc71a7e1dd3c7f77889/minigpt4-7B-f16.bin\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4、运行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加载指定模型")]),s._v("\n./run.sh dustynv/minigpt4:r35.4.1 /bin/bash "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cd /opt/minigpt4.cpp/minigpt4 && python3 webui.py $(huggingface-downloader --type=dataset maknee/minigpt4-7b-ggml/minigpt4-7B-f16.bin) $(huggingface-downloader --type=dataset maknee/ggml-vicuna-v0-quantized/ggml-vicuna-7B-v0-q5_k.bin)'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或")]),s._v("\n./run.sh "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("./autotag minigpt4"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" /bin/bash "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cd /opt/minigpt4.cpp/minigpt4 && python3 webui.py $(huggingface-downloader --type=dataset maknee/minigpt4-7b-ggml/minigpt4-7B-f16.bin) $(huggingface-downloader --type=dataset maknee/ggml-vicuna-v0-quantized/ggml-vicuna-7B-v0-q5_k.bin)'")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5、提示 huggingface 连接失败，可以使用科学上网，提示 ggml-vicuna-7B-v0-q5_k.bin 等数据集下载失败，可以修原始 docker")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("修改原始 docker")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入原生镜像并创建一个新的容器，修改里面的 /usr/local/bin/_huggingface-downloader.py 文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--entrypoint")]),s._v(" /bin/bash dustynv/minigptr：35.4.1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# root@cf8d8bb1bb76 @ 后面就是新容器id")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新容器可能需要安装vim")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/bin/_huggingface-downloader.py\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第 56 行 repo_path = hf_hub_download 修改为：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" filename "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'minigpt4-7B-f16.bin'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n    repo_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/data/models/huggingface/datasets--maknee--minigpt4-7b-ggml/snapshots/79340163b5a9a37908610cc71a7e1dd3c7f77889/minigpt4-7B-f16.bin'")]),s._v("\nelse:\n    repo_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/data/models/huggingface/datasets--maknee--ggml-vicuna-v0-quantized/snapshots/1d8789f34eb803bf52daf895c7ecfd2559cf5ccc/ggml-vicuna-7B-v0-q5_k.bin'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将容器保存为镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" commit cf8d8bb1bb76"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("容器id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" dustynv/minigpt4:r35.4.3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("新镜像名称:tag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://github.com/dusty-nv/jetson-containers/tree/master/packages/llm/minigpt4",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);