(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{373:function(a,e,t){"use strict";t.r(e);var s=t(10),r=Object(s.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"安装onlyoffice插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装onlyoffice插件"}},[a._v("#")]),a._v(" 安装onlyoffice插件")]),a._v(" "),e("h2",{attrs:{id:"_1、docker-安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、docker-安装"}},[a._v("#")]),a._v(" 1、docker 安装")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" onlyoffice "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(":80 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("3443")]),a._v(":443 "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /home/sanyer/onlyoffice/logs:/var/log/onlyoffice "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /home/sanyer/onlyoffice/data:/var/www/onlyoffice/Data "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /home/sanyer/onlyoffice/lib:/var/lib/onlyoffice "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /home/sanyer/onlyoffice/db:/var/lib/postgresql "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("always "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("JWT_SECRET")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("your_secret "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("JWT_ENABLE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("JWT_IN_BODY")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("JWT_HEADER")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("AuthorizationJwt "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("USE_UNAUTHORIZED_STORAGE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true onlyoffice/documentserver\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h2",{attrs:{id:"_2、参数说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、参数说明"}},[a._v("#")]),a._v(" 2、参数说明")]),a._v(" "),e("ul",[e("li",[e("p",[e("code",[a._v("8080:80")]),a._v(" 开放 http 访问")])]),a._v(" "),e("li",[e("p",[e("code",[a._v("3443:443")]),a._v(" 开放 https 访问")])]),a._v(" "),e("li",[e("p",[e("code",[a._v("/var/log/onlyoffice")]),a._v(" ONLYOFFICE文档日志")])]),a._v(" "),e("li",[e("p",[e("code",[a._v("/var/www/onlyoffice/Data")]),a._v(" 对于证书")])]),a._v(" "),e("li",[e("p",[e("code",[a._v("/var/lib/onlyoffice")]),a._v(" 用于文件缓存")])]),a._v(" "),e("li",[e("p",[e("code",[a._v("/var/lib/postgresql")]),a._v(" 用于数据库")])]),a._v(" "),e("li",[e("p",[e("code",[a._v("JWT_SECRET=your_secret")]),a._v("  JWT 密钥，若未填写，将自动生成 "),e("code",[a._v("/etc/onlyoffice/documentserver/local.json")])])]),a._v(" "),e("li",[e("p",[e("code",[a._v("JWT_ENABLE=true")]),a._v(" JWT 令牌验证")])]),a._v(" "),e("li",[e("p",[e("code",[a._v("JWT_IN_BODY=true")]),a._v(" 请求正文中启用令牌验证")])]),a._v(" "),e("li",[e("p",[e("code",[a._v("JWT_HEADER=AuthorizationJwt")]),a._v(" 令牌的 HTTP 标头")])]),a._v(" "),e("li",[e("p",[e("code",[a._v("USE_UNAUTHORIZED_STORAGE=true")]),a._v(" 如果服务器使用自签名证书，则需要设置该值")])])]),a._v(" "),e("h2",{attrs:{id:"_3、https-访问"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、https-访问"}},[a._v("#")]),a._v(" 3、https 访问")]),a._v(" "),e("p",[a._v("如果使用 https 访问，则需要证书：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("/app/onlyoffice/DocumentServer/data/certs/onlyoffice.key\n/app/onlyoffice/DocumentServer/data/certs/onlyoffice.crt\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("p",[a._v("如果是自签名证书，需要进入容器安装根证书")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" ./serverCA.crt onlyoffice:/usr/local/share/ca-certificates/\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" onlyoffice /bin/bash\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" update-ca-certificates\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("p",[a._v("访问 "),e("code",[a._v("https://ip:port/healthcheck")]),a._v(" 显示为 true 表示成功")]),a._v(" "),e("h2",{attrs:{id:"_4、配置-nextcloud-访问"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、配置-nextcloud-访问"}},[a._v("#")]),a._v(" 4、配置 nextcloud 访问")]),a._v(" "),e("blockquote",[e("p",[a._v("修改配置文件 /var/www/html/config/config.php")])]),a._v(" "),e("div",{staticClass:"language-php line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[a._v("  "),e("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[a._v("'onlyoffice'")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("array")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n          "),e("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[a._v("'verify_peer_off'")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token constant boolean"}},[a._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n          "),e("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[a._v('"jwt_secret"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[a._v('"your_secret"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n          "),e("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[a._v('"jwt_header"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[a._v('"AuthorizationJwt"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br")])]),e("p",[a._v("在 "),e("code",[a._v("应用")]),a._v(" => 找到 "),e("code",[a._v("ONLYOFFICE")]),a._v(" 下载并启用")]),a._v(" "),e("p",[a._v("如果下载失败，可能需要科学上网，可以离线安装，将下载的 gz 文件复制并解压到 "),e("code",[a._v("custom_apps")]),a._v(" 文件夹即可")]),a._v(" "),e("p",[a._v("然后 "),e("code",[a._v("应用")]),a._v(" => 启用 "),e("code",[a._v("ONLYOFFICE")])]),a._v(" "),e("p",[a._v("在管理设置中，找到 "),e("code",[a._v("ONLYOFFICE")]),a._v(" 选项，设置连接地址，点击保存即可")]),a._v(" "),e("p",[a._v("如果使用 https 自签名访问，则需要进入 nextcloud 容器安装根证书")]),a._v(" "),e("p",[a._v("如果无法连接，可以分别进入 onlyoffice 和 nextcloud 容器测试 "),e("code",[a._v("wget https://ip:port")]),a._v(" 是否正常访问")]),a._v(" "),e("h2",{attrs:{id:"_5、参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5、参考"}},[a._v("#")]),a._v(" 5、参考")]),a._v(" "),e("p",[e("a",{attrs:{href:"https://api.onlyoffice.com/zh/editors/basic",target:"_blank",rel:"noopener noreferrer"}},[a._v("onlyoffice docs"),e("OutboundLink")],1)]),a._v(" "),e("p",[e("a",{attrs:{href:"https://helpcenter.onlyoffice.com/installation/docs-community-install-docker.aspx",target:"_blank",rel:"noopener noreferrer"}},[a._v("onlyoffice 安装指南"),e("OutboundLink")],1)]),a._v(" "),e("p",[e("a",{attrs:{href:"https://juejin.cn/post/7195426970749337660",target:"_blank",rel:"noopener noreferrer"}},[a._v("如何使用 ONLY OFFICE 在你的 WEB 中集成 OFFICE 文档编辑功能"),e("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=r.exports}}]);