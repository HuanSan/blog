(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{327:function(a,s,t){"use strict";t.r(s);var e=t(10),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"使用docker安装nextcloud"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用docker安装nextcloud"}},[a._v("#")]),a._v(" 使用docker安装nextcloud")]),a._v(" "),s("h2",{attrs:{id:"_1、目录准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、目录准备"}},[a._v("#")]),a._v(" 1、目录准备")]),a._v(" "),s("p",[a._v("创建nextcloud目录，然后再创建三个子文件夹，如下：")]),a._v(" "),s("p",[a._v("db : nextcloud依赖的持久化数据的数据库")]),a._v(" "),s("p",[a._v("html: nextcloud的资源配置文件夹")]),a._v(" "),s("p",[a._v("data: nextcloud的个人同步文件")]),a._v(" "),s("p",[a._v("例如："),s("code",[a._v("/home/vvt/node/nextcloud")])]),a._v(" "),s("h2",{attrs:{id:"_2、安装mariadb数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、安装mariadb数据库"}},[a._v("#")]),a._v(" 2、安装mariadb数据库")]),a._v(" "),s("p",[a._v("默认情况下，NextCloud使用的是SQLite数据库进行数据存储，它仅适用于没有客户端同步的测试和轻量级单用户设置。当多用户、多设备、大数据量的时候，SQLite就不太合适了，NextCloud支持MySQL，MariaDB，Oracle 11g和PostgreSQL等多种数据库。并且推荐使用MySQL / MariaDB。所以为了一劳永逸，还是用MySQL代替吧，MariaDB是MySQL源代码的一个分支。这里使用MariaDB作为数据库支撑。")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3306")]),a._v(":3306 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("PUID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("PGID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MYSQL_DATABASE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("nextcloud "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MYSQL_USER")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("nextcloud "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MYSQL_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" db_nextcloud "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),a._v(" always "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /home/vvt/node/nextcloud/db:/var/lib/mysql mariadb\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("-d: 后台运行容器​，并返回容器ID")]),a._v(" "),s("p",[a._v("-name: 为容器指定一个名称")]),a._v(" "),s("p",[a._v("-p 3306:3306: 容器服务开放的端口,前者是宿主机的端口，后者是容器内服务的端口")]),a._v(" "),s("p",[a._v("-e PUID、-e PGID： 运行容器的用户的权限集id")]),a._v(" "),s("p",[a._v("-e MYSQL_ROOT_PASSWORD： 数据库root用户的密码")]),a._v(" "),s("p",[a._v("-e MYSQL_DATABASE=nextcloud ：创建一个名称为nextcloud的数据库")]),a._v(" "),s("p",[a._v("-e MYSQL_USER：创建一个名称为nextcloud的用户")]),a._v(" "),s("p",[a._v("-e MYSQL_PASSWORD：名称为nextcloud的用户的密码")]),a._v(" "),s("p",[a._v("-v：数据卷绑定 前者是宿主机的地址,后者是容器机器的位置")]),a._v(" "),s("h2",{attrs:{id:"_3、安装nextcloud"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、安装nextcloud"}},[a._v("#")]),a._v(" 3、安装nextcloud")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8888")]),a._v(":80 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("222")]),a._v(":22 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" nextcloud "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),a._v(" always "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /home/vvt/node/nextcloud/html:/var/www/html "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /home/vvt/node/nextcloud/data:/var/www/html/data nextcloud\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("-d: 后台运行容器​，并返回容器ID")]),a._v(" "),s("p",[a._v("-name: 为容器指定一个名称")]),a._v(" "),s("p",[a._v("-p 8888:80: 容器80端口映射到宿主机的8888端口，用于访问nextcloud站点")]),a._v(" "),s("p",[a._v("-p 222:22: 容器22端口映射到宿主机的222端口，用于访问ssh")]),a._v(" "),s("p",[a._v("-v：数据卷绑定 前者是宿主机的地址,后者是容器机器的位置")]),a._v(" "),s("p",[a._v("Nextcloud安装以及数据库之外的所有数据（文件上载等）都存储在容器地址/var/www/html中，要想持久化你的数据，不通过nextCloud也可以查看的话，应当映射到宿主机的某个位置上")]),a._v(" "),s("p",[a._v("Nextcloud的卷配置还是挺多的，例如配置(config)、数据(data)、主题(themes)等")]),a._v(" "),s("p",[a._v("nextcloud的一些卷地址：")]),a._v(" "),s("p",[a._v("/var/www/html 更新所需的主文件夹")]),a._v(" "),s("p",[a._v("/var/www/html/custom_apps你自己手动安装的应用位置")]),a._v(" "),s("p",[a._v("/var/www/html/config 本地配置文件位置")]),a._v(" "),s("p",[a._v("/var/www/html/data 你的网盘数据存放的位置")]),a._v(" "),s("p",[s("code",[a._v("/var/www/html/themes/<YOU_CUSTOM_THEME>")]),a._v(" 主题文件位置")]),a._v(" "),s("p",[a._v("以上卷映射我这里只把data单独抽出来了，其他的配置全部默认放在/var/www/html映射的位置里")]),a._v(" "),s("p",[a._v("查看容器运行 "),s("code",[a._v("docker ps")])]),a._v(" "),s("p",[a._v("浏览器输入 "),s("code",[a._v("http://你的IP:8088")]),a._v(" 即可访问nextcloud了。")]),a._v(" "),s("h2",{attrs:{id:"_4、开放nextcloud容器的ssh访问"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、开放nextcloud容器的ssh访问"}},[a._v("#")]),a._v(" 4、开放nextcloud容器的ssh访问")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 1、进入 nextcloud 容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" nextcloud /bin/bash\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 2、安装 vim 和 openssh")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" update\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" upgrade\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" openssh-server\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 3、设置 root 密码，用于ssh连接时输入")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("passwd")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 4、修改配置文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/ssh/sshd_config\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 修改如下配置：")]),a._v("\nPubkeyAuthentication "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("yes")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#启用公钥私钥配对认证方式 ")]),a._v("\nAuthorizedKeysFile .ssh/authorized_keys "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#公钥文件路径（和上面生成的文件同） ")]),a._v("\nPermitRootLogin "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("yes")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#root能使用ssh登录")]),a._v("\nClientAliveInterval "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("60")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#参数数值是秒 , 是指超时时间")]),a._v("\nClientAliveCountMax "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#设置允许超时的次数")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 5、重启 ssh 服务")]),a._v("\n/etc/init.d/ssh restart\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br")])]),s("h2",{attrs:{id:"_5、常见问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5、常见问题"}},[a._v("#")]),a._v(" 5、常见问题")]),a._v(" "),s("h3",{attrs:{id:"_5-1-如果出现如下错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-如果出现如下错误"}},[a._v("#")]),a._v(" 5.1 如果出现如下错误：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("Error while trying to create admin user: Failed to connect to the database: An exception occurred in the driver: SQLSTATE[HY000] [2002] No such file or directory\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("可能是由于未找到该数据库，在数据库地址那里输入本机ip地址+端口")]),a._v(" "),s("h3",{attrs:{id:"_5-2-调整上传文件大小限制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-调整上传文件大小限制"}},[a._v("#")]),a._v(" 5.2 调整上传文件大小限制")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" www-data php occ config:app:set files max_chunk_size "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--value")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("20971520")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"_5-3-用二级域名访问-如果出现域名不被信任"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-用二级域名访问-如果出现域名不被信任"}},[a._v("#")]),a._v(" 5.3 用二级域名访问，如果出现域名不被信任")]),a._v(" "),s("p",[a._v("修改config/config.php。在trusted_domains中增加信任的域名。")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("$CONFIG = array (\n  'instanceid' => '*******7rxp',\n  'passwordsalt' => '****************dO+JvP5wP4gX9',\n  'secret' => 'MURhZ*************r5C32dF*******4K/4dmH',\n  'trusted_domains' => \n  array (\n    0 => '192.***.*3.*',\n    1 => 'sg*****.top:****',\n    2 => 'www.sg*****.top:****',\n  ),\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("h2",{attrs:{id:"_5-4-已创建-nextcloud-容器-如何再开放容器22端口或其他端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-已创建-nextcloud-容器-如何再开放容器22端口或其他端口"}},[a._v("#")]),a._v(" 5.4 已创建 nextcloud 容器，如何再开放容器22端口或其他端口")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 停止容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" stop nextcloud\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建镜像")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" commit nextcloud new_nextcloud:001\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启动容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8888")]),a._v(":80 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("222")]),a._v(":22 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" nextcloud2 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),a._v(" always new_nextcloud:001\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h2",{attrs:{id:"_6、参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6、参考"}},[a._v("#")]),a._v(" 6、参考")]),a._v(" "),s("p",[a._v("https://zhuanlan.zhihu.com/p/435516648")]),a._v(" "),s("p",[a._v("https://zhuanlan.zhihu.com/p/48136942")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://apps.nextcloud.com/developer/apps/generate",target:"_blank",rel:"noopener noreferrer"}},[a._v("应用模板下载"),s("OutboundLink")],1)]),a._v(" "),s("p",[s("a",{attrs:{href:"https://letsencrypt.org/zh-cn/docs/client-options/",target:"_blank",rel:"noopener noreferrer"}},[a._v("证书"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);