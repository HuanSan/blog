(window.webpackJsonp=window.webpackJsonp||[]).push([[288],{579:function(t,e,s){"use strict";s.r(e);var a=s(10),r=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"申请let-s-encrypt证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#申请let-s-encrypt证书"}},[t._v("#")]),t._v(" 申请Let’s Encrypt证书")]),t._v(" "),e("p",[t._v("ACME v2 (RFC 8555) 服务器地址")]),t._v(" "),e("p",[t._v("[生产环境] "),e("code",[t._v("https://acme-v02.api.letsencrypt.org/directory")])]),t._v(" "),e("p",[t._v("[测试环境] "),e("code",[t._v("https://acme-staging-v02.api.letsencrypt.org/directory")])]),t._v(" "),e("p",[t._v("https://letsencrypt.org/zh-cn/getting-started/")]),t._v(" "),e("h2",{attrs:{id:"_1、lego"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、lego"}},[t._v("#")]),t._v(" 1、lego")]),t._v(" "),e("h3",{attrs:{id:"_1-1-安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-安装"}},[t._v("#")]),t._v(" 1.1 安装")]),t._v(" "),e("p",[t._v("下载 "),e("a",{attrs:{href:"https://github.com/go-acme/lego/tags",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/go-acme/lego/tags"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("文档 "),e("a",{attrs:{href:"https://go-acme.github.io/lego/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://go-acme.github.io/lego/"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("解压 "),e("code",[t._v("tar -zxvf lego.tar.gz")])]),t._v(" "),e("h3",{attrs:{id:"_1-2-获取证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-获取证书"}},[t._v("#")]),t._v(" 1.2 获取证书")]),t._v(" "),e("p",[t._v("（1）获取单域名")]),t._v(" "),e("p",[e("code",[t._v('./lego --email="xxx@xxx.com" --domains="test.sanyer.top" --http run')])]),t._v(" "),e("p",[t._v("您将在当前工作目录的文件夹中找到您的证书："),e("code",[t._v(".lego")])]),t._v(" "),e("p",[t._v("（2）获取通配符域名")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("在这之前，需要找到你的域名服务商，并设置 "),e("code",[t._v("--dns")]),t._v("，比如我的是阿里云，那就是 "),e("code",[t._v("--dns alidns")]),t._v("，查看更多"),e("a",{attrs:{href:"https://go-acme.github.io/lego/dns/",target:"_blank",rel:"noopener noreferrer"}},[t._v("域名服务商"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[t._v("其次需要设置两个环境变量：")])])]),t._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ALICLOUD_ACCESS_KEY")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ALICLOUD_SECRET_KEY")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("xxx\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("ol",{attrs:{start:"3"}},[e("li",[t._v("然后运行命令")])]),t._v(" "),e("p",[e("code",[t._v('./lego --email="xxx@xxx.com" --dns alidns --domains="*.sanyer.top" --http run')])]),t._v(" "),e("ol",{attrs:{start:"4"}},[e("li",[e("p",[t._v("运行命令之后会输出一个TXT文本，需要添加到域名解析的TXT记录")])]),t._v(" "),e("li",[e("p",[t._v("然后再回车下一步，提示生成成功，在当前工作目录的文件夹中的 "),e("code",[t._v(".lego")]),t._v(" 目录下找到生成的证书")])])]),t._v(" "),e("blockquote",[e("p",[t._v("注意：访问 ACME 地址可能超时（GFW）")])]),t._v(" "),e("p",[t._v("（3）修改 ACME 服务地址")]),t._v(" "),e("p",[e("code",[t._v("./lego --server=https://acme-staging-v02.api.letsencrypt.org/directory")])]),t._v(" "),e("p",[t._v("（4）端口使用情况")]),t._v(" "),e("p",[t._v("默认情况下，lego 使用 80 和 443 来验证服务器")]),t._v(" "),e("p",[t._v("（5）使用正在运行的现有 Web 服务器")]),t._v(" "),e("p",[t._v("如果在端口 80 上运行现有服务器，则该选项还需要该选项。 这只会将 http-01 质询令牌写入文件夹中的给定目录，而不会启动服务器。")]),t._v(" "),e("p",[e("code",[t._v("./lego --accept-tos --email you@example.com --http --http.webroot /path/to/webroot --domains example.com run")])]),t._v(" "),e("h3",{attrs:{id:"_1-3-续订证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-续订证书"}},[t._v("#")]),t._v(" 1.3 续订证书")]),t._v(" "),e("p",[t._v("Let's Encrypt 颁发的证书有效期为90天。 为避免证书错误，需要确保在证书过期之前续订证书。")]),t._v(" "),e("p",[t._v("默认情况下，按照最佳实践，仅当证书的到期日期少于未来 30 天时，才会续订证书。")]),t._v(" "),e("p",[e("code",[t._v('./lego --email="you@example.com" --domains="example.com" --http renew')])]),t._v(" "),e("p",[t._v("如果证书需要提前续订，您可以指定剩余天数：")]),t._v(" "),e("p",[e("code",[t._v('./lego --email="you@example.com" --domains="example.com" --http renew --days 45')])]),t._v(" "),e("h3",{attrs:{id:"_1-4-使用脚本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-使用脚本"}},[t._v("#")]),t._v(" 1.4 使用脚本")]),t._v(" "),e("p",[e("code",[t._v('./lego --email="you@example.com" --domains="example.com" --http renew --renew-hook="./myscript.sh"')])]),t._v(" "),e("h3",{attrs:{id:"_1-5-自动续订"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-自动续订"}},[t._v("#")]),t._v(" 1.5 自动续订")]),t._v(" "),e("p",[t._v("创建一个 cron 作业（或 systemd 计时器）来自动续订所有证书")]),t._v(" "),e("p",[t._v("这样做时，请注意，某些 cron 默认值会在 ACME 提供程序的基础设施上造成可测量的负载。 值得注意的是，工作在午夜运行。")]),t._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# avoid:")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#@daily      /usr/bin/lego ... renew")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#@midnight   /usr/bin/lego ... renew")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#0 0 * * *   /usr/bin/lego ... renew")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# instead, use a randomly chosen time:")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("35")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" * * *  /usr/bin/lego "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". renew\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br")])]),e("h2",{attrs:{id:"_2、certbot"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、certbot"}},[t._v("#")]),t._v(" 2、certbot")]),t._v(" "),e("p",[t._v("https://github.com/certbot/certbot")]),t._v(" "),e("h2",{attrs:{id:"_3、速率限制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、速率限制"}},[t._v("#")]),t._v(" 3、速率限制")]),t._v(" "),e("p",[t._v("生产环境：")]),t._v(" "),e("ul",[e("li",[t._v("每个注册域名可签发证书数量（每周50张）")]),t._v(" "),e("li",[t._v("每周最多 5 张重复证书的限制")]),t._v(" "),e("li",[t._v("3小时之内每个IP地址最多可以创建10个账户。 每个 IPv6 /48 地址段每 3 小时最多可以创建 500 个账户")]),t._v(" "),e("li",[t._v("3小时之内每个账户最多可以创建300个新订单")]),t._v(" "),e("li",[t._v("每份证书最多100个域名")])]),t._v(" "),e("p",[t._v("测试环境：")]),t._v(" "),e("ul",[e("li",[t._v("每个注册域名允许颁发的证书数量限制为每周 30000 张。")]),t._v(" "),e("li",[t._v("重复证书限制为每周 30000 张。")]),t._v(" "),e("li",[t._v("每小时允许 60 次验证失败。")]),t._v(" "),e("li",[t._v("每个 IP 地址注册账户数量限制为每个 IP 每 3 小时允许注册 50 个账户。")]),t._v(" "),e("li",[t._v("对于 ACME v2，新订单限制为每个帐户每 3 小时 1500 个。")])])])}),[],!1,null,null,null);e.default=r.exports}}]);