(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{324:function(s,n,e){"use strict";e.r(n);var a=e(10),t=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"c-创建-windows-服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#c-创建-windows-服务"}},[s._v("#")]),s._v(" c#创建 windows 服务")]),s._v(" "),n("p",[s._v("工具：vs2022")]),s._v(" "),n("h2",{attrs:{id:"_1、创建-windows-service-项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、创建-windows-service-项目"}},[s._v("#")]),s._v(" 1、创建 Windows Service 项目")]),s._v(" "),n("p",[s._v("在项目模版里搜索“服务”，选择“Windows 服务(.NET Framework)”")]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"1",href:"/blog/img/article/c#/1.jpg"}},[n("img",{attrs:{src:s.$withBase("/img/article/c#/1.jpg"),alt:"1"}})])]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"2",href:"/blog/img/article/c#/2.jpg"}},[n("img",{attrs:{src:s.$withBase("/img/article/c#/2.jpg"),alt:"2"}})])]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"3",href:"/blog/img/article/c#/3.jpg"}},[n("img",{attrs:{src:s.$withBase("/img/article/c#/3.jpg"),alt:"3"}})])]),s._v(" "),n("h2",{attrs:{id:"_2、输入项目代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、输入项目代码"}},[s._v("#")]),s._v(" 2、输入项目代码")]),s._v(" "),n("div",{staticClass:"language-c# line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('using Microsoft.SqlServer.Server;\nusing System;\nusing System.Collections.Generic;\nusing System.ComponentModel;\nusing System.Data;\nusing System.Diagnostics;\nusing System.IO;\nusing System.Linq;\nusing System.ServiceProcess;\nusing System.Text;\nusing System.Threading.Tasks;\nusing System.Timers;\n\nnamespace MonitorService\n{\n    public partial class ServiceMain : ServiceBase\n    {\n        public ServiceMain()\n        {\n            InitializeComponent();\n        }\n\n        protected override void OnStart(string[] args)\n        {\n            WriteLog("启动");\n            Timer timer = new Timer();\n            timer.Interval = 60000; // 60 seconds\n            timer.Elapsed += new ElapsedEventHandler(this.OnTimer);\n            timer.Start();\n        }\n\n        protected override void OnStop()\n        {\n            WriteLog("结束");\n        }\n\n        public void OnTimer(object sender, ElapsedEventArgs args)\n        {\n            StopService("wuauserv"); // 定时关闭更新服务\n            StopService("UsoSvc");\n        }\n\n        private void WriteLog(string message)\n        {\n            string path = AppDomain.CurrentDomain.SetupInformation.ApplicationBase;\n            using (StreamWriter sw = new StreamWriter(path + "Log.txt", true))\n            {\n                sw.WriteLine(DateTime.Now.ToString("G") + "=====" + message);\n            }\n        }\n\n        private void StopService(string serviceName)\n        {\n            using (ServiceController controller =new ServiceController(serviceName))\n            {\n                if(controller.Status == ServiceControllerStatus.Running)\n                {\n                    controller.Stop();\n                    WriteLog(serviceName+" stop");\n                }\n            }\n        }\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br")])]),n("h2",{attrs:{id:"_3、添加安装程序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3、添加安装程序"}},[s._v("#")]),s._v(" 3、添加安装程序")]),s._v(" "),n("p",[s._v("编辑 "),n("code",[s._v("serviceProcessInstaller1")]),s._v(" 属性 "),n("code",[s._v("Accout")]),s._v(" 为 "),n("code",[s._v("LocalService")]),s._v("(本地系统)")]),s._v(" "),n("p",[s._v("编辑 "),n("code",[s._v("serviceInstaller1")])]),s._v(" "),n("h2",{attrs:{id:"_4、安装服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4、安装服务"}},[s._v("#")]),s._v(" 4、安装服务")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装服务")]),s._v("\n%SystemRoot%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Microsoft.NET"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Framework65"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("v4.0.30319"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("InstallUtil.exe D:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("TestService.exe\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 卸载")]),s._v("\n%SystemRoot%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Microsoft.NET"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Framework65"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("v4.0.30319"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("InstallUtil.exe /u D:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("TestService.exe\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"_5、控制服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5、控制服务"}},[s._v("#")]),s._v(" 5、控制服务")]),s._v(" "),n("div",{staticClass:"language-c# line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('using System;\nusing System.Collections.Generic;\nusing System.Text;\n\nnamespace StartWindowsServiceDemo\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            string windowsServiceName = "iphlpsvc";\n            StartWindowsService(windowsServiceName);\n            StopWindowsService(windowsServiceName);\n\n            Console.Read();\n        }\n\n        /// <summary>\n        /// 开启服务\n        /// </summary>\n        /// <param name="windowsServiceName">服务名称</param>\n        static void StartWindowsService(string windowsServiceName)\n        {\n            using (System.ServiceProcess.ServiceController control = new System.ServiceProcess.ServiceController(windowsServiceName))\n            {\n                if (control.Status == System.ServiceProcess.ServiceControllerStatus.Stopped)\n                {\n                    Console.WriteLine("服务启动......");\n                    control.Start();\n                    Console.WriteLine("服务已经启动......");\n                }\n                else if(control.Status == System.ServiceProcess.ServiceControllerStatus.Running)\n                {\n                    Console.WriteLine("服务已经启动......");\n                }\n            }\n\n        }\n\n        /// <summary>\n        /// 停止服务\n        /// </summary>\n        /// <param name="windowsServiceName">服务名称</param>\n        static void StopWindowsService(string windowsServiceName)\n        {\n            using (System.ServiceProcess.ServiceController control = new System.ServiceProcess.ServiceController(windowsServiceName))\n            {\n                if (control.Status == System.ServiceProcess.ServiceControllerStatus.Running)\n                {\n                    Console.WriteLine("服务停止......");\n                    control.Stop();\n                    Console.WriteLine("服务已经停止......");\n                }\n                else if (control.Status == System.ServiceProcess.ServiceControllerStatus.Stopped)\n                {\n                    Console.WriteLine("服务已经停止......");\n                }\n            }\n        }\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);