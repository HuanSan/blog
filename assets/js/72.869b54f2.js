(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{355:function(a,s,t){"use strict";t.r(s);var e=t(10),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"内网穿透-zerotier"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内网穿透-zerotier"}},[a._v("#")]),a._v(" 内网穿透 ZeroTier")]),a._v(" "),s("h2",{attrs:{id:"_1、zerotier-概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、zerotier-概念"}},[a._v("#")]),a._v(" 1、ZeroTier 概念")]),a._v(" "),s("p",[a._v("ZeroTier 是一款利用 UDP 打洞来实现内网穿透的工具，其基本工作原理是组建一个虚拟局域网，各个设备（NAS、Linux、Windows、Mac、iOS、Android）安装了客户端、加入到这个虚拟局域网后，就会自动分配一个 IP，从而实现局域网内各个设备及服务的相互访问。")]),a._v(" "),s("p",[a._v("ZeroTier 专有名词：")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("PLANET")]),a._v(" 行星服务器，ZeroTier 官方根服务器，在国外。免费版最大支持 25 个设备连接。")]),a._v(" "),s("li",[s("code",[a._v("MOON")]),a._v(" 卫星服务器，私有根服务器，可以利用带有公网 IP 的云服务器自己搭建，起到代理加速的作用")]),a._v(" "),s("li",[s("code",[a._v("LEAF")]),a._v(" 网络客户端，连接到根服务器的网络节点，如上述提到的 NAS、群晖、Linux、Windows 等")])]),a._v(" "),s("p",[a._v("通过 ZeroTier 官方根服务器建立虚拟局域网，优点是在没有自带公网 IP 的云服务器的情况下也可以异地组网，部署简单快捷，全地球都可以访问；缺点是：① 免费版允许连接的设备有限，最大 25 台，不过个人或小团队使用的话也够用了；② 数据不安全，毕竟是外国的服务器，一般没什么重要数据的情况下可以使用；③ 受网络波动影响，用网高峰期可能连接不稳定；")]),a._v(" "),s("h2",{attrs:{id:"_2、自建-zerotier-planet-行星服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、自建-zerotier-planet-行星服务器"}},[a._v("#")]),a._v(" 2、自建 ZeroTier Planet 行星服务器")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/Jonnyan404/zerotier-planet",target:"_blank",rel:"noopener noreferrer"}},[a._v("参考 1"),s("OutboundLink")],1)]),a._v(" "),s("p",[s("a",{attrs:{href:"https://www.mrdoc.fun/doc/443/",target:"_blank",rel:"noopener noreferrer"}},[a._v("参考 2"),s("OutboundLink")],1)]),a._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/xubiaolin/docker-zerotier-planet",target:"_blank",rel:"noopener noreferrer"}},[a._v("参考 3"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"_2-1-必要条件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-必要条件"}},[a._v("#")]),a._v(" 2.1 必要条件")]),a._v(" "),s("ul",[s("li",[a._v("具有公网 ip 的服务器")]),a._v(" "),s("li",[a._v("安装 docker")]),a._v(" "),s("li",[a._v("安装 docker-compose")]),a._v(" "),s("li",[a._v("防火墙开放 TCP 端口 4000/9993/3180 和 UDP 端口 9993")])]),a._v(" "),s("h3",{attrs:{id:"_2-2-安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-安装"}},[a._v("#")]),a._v(" 2.2 安装")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 如果从window拉取可能会出现行尾序列CRLF自动转换，需要将patch.sh文件换行转换为LF格式")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" clone https://github.com/Jonnyan404/zerotier-planet\nOR\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" clone https://gitee.com/Jonnyan404/zerotier-planet\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" zerotier-planet\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 修改 docker-compose.yml 文件的 MYADDR 改为服务器公网ip")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" docker-compose.yml\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 生成并启动docker")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" up "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 以下步骤为创建planet和moon")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" mkmoonworld-x86_64 ztncui:/tmp\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" patch.sh ztncui:/tmp\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" ztncui "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v(" /tmp/patch.sh\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" restart ztncui\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br")])]),s("p",[a._v("然后浏览器访问 "),s("code",[a._v("http://ip:4000")]),a._v(" 打开 web 控制台界面。")]),a._v(" "),s("ul",[s("li",[a._v("用户名:"),s("code",[a._v("admin")])]),a._v(" "),s("li",[a._v("密码:"),s("code",[a._v("mrdoc.fun")])])]),a._v(" "),s("p",[a._v("登录之后，点击 "),s("code",[a._v("Add network")]),a._v(" 添加一个网络，会自动生成网络 id")]),a._v(" "),s("p",[a._v("浏览器访问 "),s("code",[a._v("http://ip:3180")]),a._v(" 打开 "),s("code",[a._v("planet")]),a._v(" 和 "),s("code",[a._v("moon")]),a._v(" 文件下载页面（亦可在项目根目录的 "),s("code",[a._v("./ztncui/etc/myfs/")]),a._v(" 里获取）。")]),a._v(" "),s("h2",{attrs:{id:"_3、客户端使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、客户端使用"}},[a._v("#")]),a._v(" 3、客户端使用")]),a._v(" "),s("h3",{attrs:{id:"_3-1-windows-客户端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-windows-客户端"}},[a._v("#")]),a._v(" 3.1 Windows 客户端")]),a._v(" "),s("p",[a._v("（1）首先去 ZeroTier 官网下载一个 "),s("a",{attrs:{href:"https://www.zerotier.com/download/",target:"_blank",rel:"noopener noreferrer"}},[a._v("ZeroTier Windows 客户端"),s("OutboundLink")],1),a._v("并安装")]),a._v(" "),s("p",[a._v("（2）将 "),s("code",[a._v("planet")]),a._v(" 文件覆盖粘贴到 "),s("code",[a._v("C:\\ProgramData\\ZeroTier\\One")]),a._v(" 中(这个目录是个隐藏目录，需要运允许查看隐藏目录才行)")]),a._v(" "),s("p",[a._v("（3）Win+S 搜索 服务，找到 ZeroTier One，并且重启服务")]),a._v(" "),s("p",[a._v("（3）使用管理员身份打开 PowerShell 执行如下命令，看到 join ok 字样就成功了")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("PS C:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Windows"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("system3"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),a._v(" zerotier-cli.bat "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("join")]),a._v(" 网络id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("就是在网页里面创建的那个网络"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("200")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("join")]),a._v(" OK\nPS C:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Windows"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("system3"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("（4）登录管理后台看到新的客户端，勾选 Authorized 和 Active bridge")]),a._v(" "),s("p",[a._v("点击 "),s("code",[a._v("Easy setup")]),a._v(" 设置虚拟网段")]),a._v(" "),s("ul",[s("li",[a._v("10.0.12.0/24（网络地址，Network address in CIDR notation）")]),a._v(" "),s("li",[a._v("10.0.12.1（起始IP，Start of IP assignment pool）")]),a._v(" "),s("li",[a._v("10.0.12.254（结束IP，End of IP assignment pool）")])]),a._v(" "),s("p",[a._v("（5）查看连接状态")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("zerotier-cli.bat peers\n\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("200")]),a._v(" peers\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("ztaddr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("   "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("ver"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("role"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("lat"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("link"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("lastTX"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("lastRX"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("path"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\nfcbaeb9b6c "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.8")]),a._v(".7  PLANET    "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("52")]),a._v(" DIRECT "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("16")]),a._v("       "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8994")]),a._v("     "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.1")]),a._v(".1.1/9993\nfe92971aad "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.8")]),a._v(".7  LEAF      "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("14")]),a._v(" DIRECT "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-1")]),a._v("       "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4150")]),a._v("     "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2.2")]),a._v(".2.2/9993\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("可以看到有一个 PLANTET 和 LEAF 角色，连接方式均为 DIRECT(直连)，到这里就加入网络成功了")]),a._v(" "),s("h3",{attrs:{id:"_3-2-linux-客户端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-linux-客户端"}},[a._v("#")]),a._v(" 3.2 Linux 客户端")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安装客户端")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" https://install.zerotier.com "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 复制替换 planet 文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" /var/lib/zerotier-one/planet\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" ./planet /var/lib/zerotier-one/planet\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设置 planet 文件访问权限")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chown")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-R")]),a._v(" zerotier-one: /var/lib/zerotier-one/planet\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 重启服务")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl restart zerotier-one\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 加入网络")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" zerotier-cli "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("join")]),a._v(" f789667a224b2d15\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br")])]),s("h3",{attrs:{id:"_3-3-安卓客户端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-安卓客户端"}},[a._v("#")]),a._v(" 3.3 安卓客户端")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/kaaass/ZerotierFix",target:"_blank",rel:"noopener noreferrer"}},[a._v("ZerotierFix"),s("OutboundLink")],1),a._v(" "),s("a",{attrs:{href:"https://www.v2ex.com/t/768628",target:"_blank",rel:"noopener noreferrer"}},[a._v("Zerotier 非官方安卓客户端发布：支持自建 Moon 节点 - V2EX"),s("OutboundLink")],1)]),a._v(" "),s("h2",{attrs:{id:"_4、访问局域网内其他节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、访问局域网内其他节点"}},[a._v("#")]),a._v(" 4、访问局域网内其他节点")]),a._v(" "),s("p",[a._v("假设有场景 "),s("code",[a._v("公司总部 192.168.1.0")]),a._v(" "),s("code",[a._v("公司分部A 192.168.12.0")]),a._v(" "),s("code",[a._v("公司分部B 192.168.13.0")])]),a._v(" "),s("p",[a._v("访问场景1："),s("code",[a._v("公司分部A")]),a._v(" 需要访问 "),s("code",[a._v("公司总部")])]),a._v(" "),s("ul",[s("li",[s("code",[a._v("公司总部")]),a._v(" Z001 服务器安装 zerotier client，虚拟IP为 10.0.12.1")]),a._v(" "),s("li",[s("code",[a._v("公司分部A")]),a._v(" A001 服务器安装 zerotier client，虚拟IP为 10.0.12.2")])]),a._v(" "),s("h3",{attrs:{id:"_4-1-设置路由转发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-设置路由转发"}},[a._v("#")]),a._v(" 4.1 设置路由转发")]),a._v(" "),s("p",[a._v("进入 zerotier 行星服务器后台 web 管理页，进入 routes，添加一条 route")]),a._v(" "),s("p",[a._v("Add new route:")]),a._v(" "),s("ul",[s("li",[a._v("192.168.1.0/24 (Target)")]),a._v(" "),s("li",[a._v("10.0.12.1（Gateway，via）")])]),a._v(" "),s("h3",{attrs:{id:"_4-2-开启内核转发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-开启内核转发"}},[a._v("#")]),a._v(" 4.2 开启内核转发")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/sysctl.conf\nnet.ipv4.ip_forward "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sysctl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h3",{attrs:{id:"_4-3-防火墙设置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-防火墙设置"}},[a._v("#")]),a._v(" 4.3 防火墙设置")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("iptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" FORWARD "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" ztxxxxxx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\niptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" FORWARD "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" ztxxxxxx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\niptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" POSTROUTING "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" ztxxxxxx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" MASQUERADE\n\niptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" POSTROUTING "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" eth0 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" MASQUERADE\niptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" FORWARD "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" conntrack "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--ctstate")]),a._v(" RELATED,ESTABLISHED "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\niptables "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" FORWARD "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" ztxxxxxx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" eth0 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 其中的 ztxxxxxx 在不同的机器中不一样，你可以在路由器 ssh 环境中用 zerotier-cli listnetworks 或者 ifconfig 查询 zt 开头的网卡名")]),a._v("\niptables-save "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 保存配置到文件,否则重启规则会丢失")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 客户端设置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" zerotier-cli "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" 网络id "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("allowGlobal")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" zerotier-cli "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" 网络id "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("allowDefault")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br")])]),s("p",[s("a",{attrs:{href:"https://github.com/zerotier/ZeroTierOne",target:"_blank",rel:"noopener noreferrer"}},[a._v("ZeroTierOne"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);