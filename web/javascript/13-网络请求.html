<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>网络请求 | sanyer</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog/favicon.ico">
    <link rel="stylesheet" href="/blog/css/index.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    <meta name="description" content="This is sanyer blog.">
    
    <link rel="preload" href="/blog/assets/css/0.styles.8b992e03.css" as="style"><link rel="preload" href="/blog/assets/js/app.3f235546.js" as="script"><link rel="preload" href="/blog/assets/js/2.ea2cf60a.js" as="script"><link rel="preload" href="/blog/assets/js/53.840e5bc7.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.28c8f52e.js"><link rel="prefetch" href="/blog/assets/js/100.455272c3.js"><link rel="prefetch" href="/blog/assets/js/101.74643fc8.js"><link rel="prefetch" href="/blog/assets/js/102.9d964bc9.js"><link rel="prefetch" href="/blog/assets/js/103.94b8e583.js"><link rel="prefetch" href="/blog/assets/js/104.4ed0f00d.js"><link rel="prefetch" href="/blog/assets/js/105.af819587.js"><link rel="prefetch" href="/blog/assets/js/106.a375a5ca.js"><link rel="prefetch" href="/blog/assets/js/107.4a8399d5.js"><link rel="prefetch" href="/blog/assets/js/108.0edf7b02.js"><link rel="prefetch" href="/blog/assets/js/109.af0fe709.js"><link rel="prefetch" href="/blog/assets/js/11.1f5db53f.js"><link rel="prefetch" href="/blog/assets/js/110.8ca87344.js"><link rel="prefetch" href="/blog/assets/js/111.5034c388.js"><link rel="prefetch" href="/blog/assets/js/112.5ae4e366.js"><link rel="prefetch" href="/blog/assets/js/113.9aa2d76f.js"><link rel="prefetch" href="/blog/assets/js/114.b029fe5d.js"><link rel="prefetch" href="/blog/assets/js/115.91d2e5ca.js"><link rel="prefetch" href="/blog/assets/js/116.e8794717.js"><link rel="prefetch" href="/blog/assets/js/117.034ce4a5.js"><link rel="prefetch" href="/blog/assets/js/118.85fddf05.js"><link rel="prefetch" href="/blog/assets/js/119.343bea48.js"><link rel="prefetch" href="/blog/assets/js/12.c8e63883.js"><link rel="prefetch" href="/blog/assets/js/120.4e6e22e9.js"><link rel="prefetch" href="/blog/assets/js/121.6cf46051.js"><link rel="prefetch" href="/blog/assets/js/122.3535b6c3.js"><link rel="prefetch" href="/blog/assets/js/123.77ae5246.js"><link rel="prefetch" href="/blog/assets/js/124.b31cb06d.js"><link rel="prefetch" href="/blog/assets/js/125.9b8c8f41.js"><link rel="prefetch" href="/blog/assets/js/126.f84afd03.js"><link rel="prefetch" href="/blog/assets/js/127.3ee02c24.js"><link rel="prefetch" href="/blog/assets/js/128.fd66dc9b.js"><link rel="prefetch" href="/blog/assets/js/129.6590b942.js"><link rel="prefetch" href="/blog/assets/js/13.8e9f13c9.js"><link rel="prefetch" href="/blog/assets/js/14.518afb2c.js"><link rel="prefetch" href="/blog/assets/js/15.7269d1f2.js"><link rel="prefetch" href="/blog/assets/js/16.900906f7.js"><link rel="prefetch" href="/blog/assets/js/17.bce917ff.js"><link rel="prefetch" href="/blog/assets/js/18.85591399.js"><link rel="prefetch" href="/blog/assets/js/19.9e1f1ae0.js"><link rel="prefetch" href="/blog/assets/js/20.e0303f28.js"><link rel="prefetch" href="/blog/assets/js/21.ae46f1b5.js"><link rel="prefetch" href="/blog/assets/js/22.4d4fcd72.js"><link rel="prefetch" href="/blog/assets/js/23.07080f05.js"><link rel="prefetch" href="/blog/assets/js/24.9f977115.js"><link rel="prefetch" href="/blog/assets/js/25.07533e7b.js"><link rel="prefetch" href="/blog/assets/js/26.f4332856.js"><link rel="prefetch" href="/blog/assets/js/27.c138bb8e.js"><link rel="prefetch" href="/blog/assets/js/28.3ddd2dbc.js"><link rel="prefetch" href="/blog/assets/js/29.db9217ea.js"><link rel="prefetch" href="/blog/assets/js/3.8e222729.js"><link rel="prefetch" href="/blog/assets/js/30.2e9bdf28.js"><link rel="prefetch" href="/blog/assets/js/31.87da83df.js"><link rel="prefetch" href="/blog/assets/js/32.26f682b5.js"><link rel="prefetch" href="/blog/assets/js/33.ebd9e182.js"><link rel="prefetch" href="/blog/assets/js/34.0478933f.js"><link rel="prefetch" href="/blog/assets/js/35.736bc3ab.js"><link rel="prefetch" href="/blog/assets/js/36.e94c5d8f.js"><link rel="prefetch" href="/blog/assets/js/37.5133e298.js"><link rel="prefetch" href="/blog/assets/js/38.a3f75a87.js"><link rel="prefetch" href="/blog/assets/js/39.8e0089df.js"><link rel="prefetch" href="/blog/assets/js/4.200b0e8f.js"><link rel="prefetch" href="/blog/assets/js/40.4a054a0e.js"><link rel="prefetch" href="/blog/assets/js/41.56ae2cae.js"><link rel="prefetch" href="/blog/assets/js/42.cba67b83.js"><link rel="prefetch" href="/blog/assets/js/43.338c30b4.js"><link rel="prefetch" href="/blog/assets/js/44.60f3a038.js"><link rel="prefetch" href="/blog/assets/js/45.c86884e6.js"><link rel="prefetch" href="/blog/assets/js/46.b00c35a4.js"><link rel="prefetch" href="/blog/assets/js/47.9f232c11.js"><link rel="prefetch" href="/blog/assets/js/48.e32c4adc.js"><link rel="prefetch" href="/blog/assets/js/49.d83aa902.js"><link rel="prefetch" href="/blog/assets/js/5.ee0355db.js"><link rel="prefetch" href="/blog/assets/js/50.e515fead.js"><link rel="prefetch" href="/blog/assets/js/51.7f62eab1.js"><link rel="prefetch" href="/blog/assets/js/52.4126f336.js"><link rel="prefetch" href="/blog/assets/js/54.189fdcc5.js"><link rel="prefetch" href="/blog/assets/js/55.22c1817e.js"><link rel="prefetch" href="/blog/assets/js/56.b0a5aab7.js"><link rel="prefetch" href="/blog/assets/js/57.4cd79927.js"><link rel="prefetch" href="/blog/assets/js/58.fe143d5c.js"><link rel="prefetch" href="/blog/assets/js/59.66d2d485.js"><link rel="prefetch" href="/blog/assets/js/6.a1f3b894.js"><link rel="prefetch" href="/blog/assets/js/60.e7b5e68f.js"><link rel="prefetch" href="/blog/assets/js/61.e3258ace.js"><link rel="prefetch" href="/blog/assets/js/62.05b715bf.js"><link rel="prefetch" href="/blog/assets/js/63.11fbaa56.js"><link rel="prefetch" href="/blog/assets/js/64.eb8ac02f.js"><link rel="prefetch" href="/blog/assets/js/65.44a0d00b.js"><link rel="prefetch" href="/blog/assets/js/66.da8505db.js"><link rel="prefetch" href="/blog/assets/js/67.f27d9c9e.js"><link rel="prefetch" href="/blog/assets/js/68.5a6cab4d.js"><link rel="prefetch" href="/blog/assets/js/69.8fd9bbb8.js"><link rel="prefetch" href="/blog/assets/js/7.6b13028f.js"><link rel="prefetch" href="/blog/assets/js/70.262714b5.js"><link rel="prefetch" href="/blog/assets/js/71.62ba8839.js"><link rel="prefetch" href="/blog/assets/js/72.1e93dcda.js"><link rel="prefetch" href="/blog/assets/js/73.07ccaab8.js"><link rel="prefetch" href="/blog/assets/js/74.78d104a5.js"><link rel="prefetch" href="/blog/assets/js/75.5c69dbc9.js"><link rel="prefetch" href="/blog/assets/js/76.3b3bf201.js"><link rel="prefetch" href="/blog/assets/js/77.bb04b39c.js"><link rel="prefetch" href="/blog/assets/js/78.46d796b6.js"><link rel="prefetch" href="/blog/assets/js/79.3e2c19e3.js"><link rel="prefetch" href="/blog/assets/js/8.5dcebb91.js"><link rel="prefetch" href="/blog/assets/js/80.f792e2aa.js"><link rel="prefetch" href="/blog/assets/js/81.cdf21c4b.js"><link rel="prefetch" href="/blog/assets/js/82.d7276d0f.js"><link rel="prefetch" href="/blog/assets/js/83.a6200328.js"><link rel="prefetch" href="/blog/assets/js/84.a0d8c260.js"><link rel="prefetch" href="/blog/assets/js/85.b639b13e.js"><link rel="prefetch" href="/blog/assets/js/86.6ffe98bf.js"><link rel="prefetch" href="/blog/assets/js/87.d2839023.js"><link rel="prefetch" href="/blog/assets/js/88.37a6df27.js"><link rel="prefetch" href="/blog/assets/js/89.4e281ab4.js"><link rel="prefetch" href="/blog/assets/js/9.d6e484ee.js"><link rel="prefetch" href="/blog/assets/js/90.c8742aed.js"><link rel="prefetch" href="/blog/assets/js/91.984718a9.js"><link rel="prefetch" href="/blog/assets/js/92.162ffb66.js"><link rel="prefetch" href="/blog/assets/js/93.f85811fb.js"><link rel="prefetch" href="/blog/assets/js/94.ed77e688.js"><link rel="prefetch" href="/blog/assets/js/95.b52925df.js"><link rel="prefetch" href="/blog/assets/js/96.3a237c64.js"><link rel="prefetch" href="/blog/assets/js/97.aaf30632.js"><link rel="prefetch" href="/blog/assets/js/98.ce4b69c8.js"><link rel="prefetch" href="/blog/assets/js/99.684d2db4.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.8b992e03.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/img/logo.png" alt="sanyer" class="logo"> <span class="site-name can-hide">sanyer</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端技术分享" class="dropdown-title"><span class="title">前端技术分享</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端技术分享" class="mobile-dropdown-title"><span class="title">前端技术分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/web/javascript/" class="nav-link router-link-active">
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/css/" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/babel/" class="nav-link">
  babel
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/weex/" class="nav-link">
  weex
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/typescript/" class="nav-link">
  typescript
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/node/" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/webrtc/" class="nav-link">
  WebRTC
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/network/" class="nav-link">
  网络知识
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/design/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/algorithm/" class="nav-link">
  数据结构/算法
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/security/" class="nav-link">
  安全
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/interview/" class="nav-link">
  面试题
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/booklist/" class="nav-link">
  书单
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="原创文章" class="dropdown-title"><span class="title">原创文章</span> <span class="arrow down"></span></button> <button type="button" aria-label="原创文章" class="mobile-dropdown-title"><span class="title">原创文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/article/website/" class="nav-link">
  站点分享
</a></li><li class="dropdown-item"><!----> <a href="/blog/article/git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/blog/article/configure/" class="nav-link">
  配置说明
</a></li><li class="dropdown-item"><!----> <a href="/blog/article/android/" class="nav-link">
  Android
</a></li></ul></div></div><div class="nav-item"><a href="https://sanyers.github.io/resume/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人简历
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="git" class="dropdown-title"><span class="title">git</span> <span class="arrow down"></span></button> <button type="button" aria-label="git" class="mobile-dropdown-title"><span class="title">git</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/sanyers/blog.git" target="_blank" rel="noopener noreferrer" class="nav-link external">
  gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/sanyers/blog.git" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端技术分享" class="dropdown-title"><span class="title">前端技术分享</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端技术分享" class="mobile-dropdown-title"><span class="title">前端技术分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/web/javascript/" class="nav-link router-link-active">
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/css/" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/vue/" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/babel/" class="nav-link">
  babel
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/weex/" class="nav-link">
  weex
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/typescript/" class="nav-link">
  typescript
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/node/" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/webrtc/" class="nav-link">
  WebRTC
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/network/" class="nav-link">
  网络知识
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/design/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/algorithm/" class="nav-link">
  数据结构/算法
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/security/" class="nav-link">
  安全
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/interview/" class="nav-link">
  面试题
</a></li><li class="dropdown-item"><!----> <a href="/blog/web/booklist/" class="nav-link">
  书单
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="原创文章" class="dropdown-title"><span class="title">原创文章</span> <span class="arrow down"></span></button> <button type="button" aria-label="原创文章" class="mobile-dropdown-title"><span class="title">原创文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/article/website/" class="nav-link">
  站点分享
</a></li><li class="dropdown-item"><!----> <a href="/blog/article/git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/blog/article/configure/" class="nav-link">
  配置说明
</a></li><li class="dropdown-item"><!----> <a href="/blog/article/android/" class="nav-link">
  Android
</a></li></ul></div></div><div class="nav-item"><a href="https://sanyers.github.io/resume/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人简历
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="git" class="dropdown-title"><span class="title">git</span> <span class="arrow down"></span></button> <button type="button" aria-label="git" class="mobile-dropdown-title"><span class="title">git</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/sanyers/blog.git" target="_blank" rel="noopener noreferrer" class="nav-link external">
  gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/sanyers/blog.git" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/web/javascript/" aria-current="page" class="sidebar-link">js基础知识</a></li><li><a href="/blog/web/javascript/1.1-js数据类型.html" class="sidebar-link">1.1-js数据类型</a></li><li><a href="/blog/web/javascript/1.2-undefined与null的区别.html" class="sidebar-link">1.2-undefined与null的区别</a></li><li><a href="/blog/web/javascript/1.3-js基础数据类型详解.html" class="sidebar-link">1.3-js基础数据类型详解</a></li><li><a href="/blog/web/javascript/1.4-js基本引用类型详解.html" class="sidebar-link">1.4-js基本引用类型详解</a></li><li><a href="/blog/web/javascript/1.5-js集合引用类型详解.html" class="sidebar-link">1.5-js集合引用类型详解</a></li><li><a href="/blog/web/javascript/2.1-js变量详解.html" class="sidebar-link">2.1-js变量详解</a></li><li><a href="/blog/web/javascript/2.2-js作用域及作用域链.html" class="sidebar-link">2.2-js作用域及作用域链</a></li><li><a href="/blog/web/javascript/2.3-js执行上下文.html" class="sidebar-link">2.3-js执行上下文</a></li><li><a href="/blog/web/javascript/3-js运算符优先级.html" class="sidebar-link">3-js运算符优先级</a></li><li><a href="/blog/web/javascript/4.1-js对象详解.html" class="sidebar-link">4.1-js对象详解</a></li><li><a href="/blog/web/javascript/4.2-entries和fromEntries用法.html" class="sidebar-link">4.2-entries和fromEntries用法</a></li><li><a href="/blog/web/javascript/5.1-js函数.html" class="sidebar-link">5.1-js函数</a></li><li><a href="/blog/web/javascript/5.2-js函数柯里化.html" class="sidebar-link">5.2-js函数柯里化</a></li><li><a href="/blog/web/javascript/5.3-js函数防抖和节流.html" class="sidebar-link">5.3-js函数防抖和节流</a></li><li><a href="/blog/web/javascript/5.4-Promise与异步函数.html" class="sidebar-link">5.4-Promise与异步函数</a></li><li><a href="/blog/web/javascript/6-js迭代器与生成器.html" class="sidebar-link">6-js迭代器与生成器</a></li><li><a href="/blog/web/javascript/7-js代理与反射.html" class="sidebar-link">7-js代理与反射</a></li><li><a href="/blog/web/javascript/8.1-DOM.html" class="sidebar-link">8.1-DOM</a></li><li><a href="/blog/web/javascript/8.2-DOM扩展.html" class="sidebar-link">8.2-DOM扩展</a></li><li><a href="/blog/web/javascript/8.3-BOM.html" class="sidebar-link">8.3-BOM</a></li><li><a href="/blog/web/javascript/9.1-事件.html" class="sidebar-link">9.1-事件</a></li><li><a href="/blog/web/javascript/10-动画与canvas图形.html" class="sidebar-link">10-动画与canvas图形</a></li><li><a href="/blog/web/javascript/11-错误处理与调试.html" class="sidebar-link">11-错误处理与调试</a></li><li><a href="/blog/web/javascript/12.1-处理XML.html" class="sidebar-link">12.1-处理XML</a></li><li><a href="/blog/web/javascript/12.2-处理JSON.html" class="sidebar-link">12.2-处理JSON</a></li><li><a href="/blog/web/javascript/13-网络请求.html" class="active sidebar-link">13-网络请求</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_1、xmlhttprequest-对象" class="sidebar-link">1、XMLHttpRequest 对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_1-1-封装简易版-ajax" class="sidebar-link">1.1 封装简易版 ajax</a></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_1-2-xhr" class="sidebar-link">1.2 XHR</a></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_1-2-http-头部" class="sidebar-link">1.2 HTTP 头部</a></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_1-3-content-type" class="sidebar-link">1.3 Content-Type</a></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_1-4-超时处理" class="sidebar-link">1.4 超时处理</a></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_1-5-overridemimetype" class="sidebar-link">1.5 overrideMimeType()</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_2、进度事件" class="sidebar-link">2、进度事件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_2-1-load-事件" class="sidebar-link">2.1 load 事件</a></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_2-2-progress-事件" class="sidebar-link">2.2 progress 事件</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_3、跨源资源共享" class="sidebar-link">3、跨源资源共享</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_3-1-预检请求" class="sidebar-link">3.1 预检请求</a></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_3-2-凭据请求" class="sidebar-link">3.2 凭据请求</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_4、替代性跨源技术" class="sidebar-link">4、替代性跨源技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_4-1-图片探测" class="sidebar-link">4.1 图片探测</a></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_4-2-jsonp" class="sidebar-link">4.2 JSONP</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_5、fetch-api" class="sidebar-link">5、Fetch API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_5-1-基本用法" class="sidebar-link">5.1 基本用法</a></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_5-2-常见-fetch-请求模式" class="sidebar-link">5.2 常见 Fetch 请求模式</a></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_5-3-headers-对象" class="sidebar-link">5.3 Headers 对象</a></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_5-4-request-对象" class="sidebar-link">5.4 Request 对象</a></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_5-5-response-对象" class="sidebar-link">5.5 Response 对象</a></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_5-6-body" class="sidebar-link">5.6 body</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_6、beacon-api" class="sidebar-link">6、Beacon API</a></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_7、web-socket" class="sidebar-link">7、Web Socket</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_7-1-api" class="sidebar-link">7.1 API</a></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_7-2-发送和接收数据" class="sidebar-link">7.2 发送和接收数据</a></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_7-3-其他事件" class="sidebar-link">7.3 其他事件</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/web/javascript/13-网络请求.html#_8、安全" class="sidebar-link">8、安全</a></li></ul></li><li><a href="/blog/web/javascript/14-客户端存储.html" class="sidebar-link">14-客户端存储</a></li><li><a href="/blog/web/javascript/15-模块化.html" class="sidebar-link">15-模块化</a></li><li><a href="/blog/web/javascript/16.1-垃圾回收.html" class="sidebar-link">16.1-垃圾回收</a></li><li><a href="/blog/web/javascript/16.2-内存泄漏.html" class="sidebar-link">16.2-内存泄漏</a></li><li><a href="/blog/web/javascript/17-工作者线程.html" class="sidebar-link">17-工作者线程</a></li><li><a href="/blog/web/javascript/18-es6~es13.html" class="sidebar-link">18-es6~es13</a></li><li><a href="/blog/web/javascript/19-js面试题汇总.html" class="sidebar-link">19-js面试题汇总</a></li><li><a href="/blog/web/javascript/jsapi.html" class="sidebar-link">jsapi</a></li><li><a href="/blog/web/javascript/js处理二进制.html" class="sidebar-link">js处理二进制</a></li><li><a href="/blog/web/javascript/Symbol.html" class="sidebar-link">Symbol</a></li><li><a href="/blog/web/javascript/作用域的问题.html" class="sidebar-link">作用域的问题</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="网络请求"><a href="#网络请求" class="header-anchor">#</a> 网络请求</h1> <p>2005 年，Jesse James Garrett 撰写了一篇文章，“Ajax—A New Approach to Web Applications”。这篇文章中描绘了一个被他称作 Ajax（Asynchronous JavaScript+XML，即异步 JavaScript 加 XML）的技术。这个技术涉及发送服务器请求额外数据而不刷新页面，从而实现更好的用户体验。</p> <p>把 Ajax 推到历史舞台上的关键技术是 XMLHttpRequest（XHR）对象。这个对象最早由微软发明，然后被其他浏览器所借鉴。</p> <p>XHR 为发送服务器请求和获取响应提供了合理的接口。这个接口可以实现异步从服务器获取额外数据，意味着用户点击不用页面刷新也可以获取数据。通过 XHR 对象获取数据后，可以使用 DOM 方法把数据插入网页。虽然 Ajax 这个名称中包含 XML，但实际上 Ajax 通信与数据格式无关。这个技术主要是可以实现在不刷新页面的情况下从服务器获取数据，格式并不一定是 XML。</p> <p>XHR 对象的 API 被普遍认为比较难用，而 Fetch API 自从诞生以后就迅速成为了 XHR 更现代的替代标准。Fetch API 支持期约（promise）和服务线程（service worker），已经成为极其强大的 Web 开发工具。</p> <h2 id="_1、xmlhttprequest-对象"><a href="#_1、xmlhttprequest-对象" class="header-anchor">#</a> 1、XMLHttpRequest 对象</h2> <h3 id="_1-1-封装简易版-ajax"><a href="#_1-1-封装简易版-ajax" class="header-anchor">#</a> 1.1 封装简易版 ajax</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> ajax <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">createRequest</span><span class="token punctuation">(</span><span class="token parameter">method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> contentType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建 XMLHttpRequest 实例</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    contentType <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> contentType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">fn</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送请求</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ajax<span class="token punctuation">.</span><span class="token function">createRequest</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">post</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ajax<span class="token punctuation">.</span><span class="token function">createRequest</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> <span class="token string">'application/json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 发送get</span>
ajax<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/test?a=1&amp;b=2'</span><span class="token punctuation">,</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 发送post</span>
ajax<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/user'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="_1-2-xhr"><a href="#_1-2-xhr" class="header-anchor">#</a> 1.2 XHR</h3> <p>open(method, url, async) 方法，接收三个参数：method 请求类型（&quot;get&quot;、&quot;post&quot;等）、请求 url 和是否异步。调用 open() 只会为发送请求准备。</p> <p>send() 方法接收一个参数，是作为请求体发送的数据。如果不需要发送请求体，则必须传 null，因为这个参数在某些浏览器中是必需的。调用 send() 之后，请求就会发送到服务器。</p> <p>收到响应后，XHR 对象的以下属性会被填充上数据：</p> <ul><li>readyState 表示当前处在请求/响应过程的哪个阶段
<ul><li>0 未初始化（Uninitialized）。尚未调用 open() 方法。</li> <li>1 已打开（Open）。已调用 open() 方法，尚未调用 send() 方法。</li> <li>2 已发送（Sent）。已调用 send() 方法，尚未收到响应。</li> <li>3 接收中（Receiving）。已经收到部分响应。</li> <li>4 完成（Complete）。已经收到所有响应，可以使用了。</li></ul></li> <li>responseText 作为响应体返回的文本。</li> <li>responseXML 如果响应的内容类型是&quot;text/xml&quot;或&quot;application/xml&quot;，那就是包含响应数据的 XML DOM 文档。</li> <li>response 响应体</li> <li>status：响应的 HTTP 状态。</li> <li>statusText：响应的 HTTP 状态描述。</li></ul> <p>每次 readyState 从一个值变成另一个值，都会触发 readystatechange 事件。</p> <p>在收到响应之前如果想取消异步请求，可以调用 abort() 方法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_1-2-http-头部"><a href="#_1-2-http-头部" class="header-anchor">#</a> 1.2 HTTP 头部</h3> <p>默认情况下，XHR 请求会发送以下头部字段。</p> <ul><li>Accept：浏览器可以处理的内容类型。</li> <li>Accept-Charset：浏览器可以显示的字符集。</li> <li>Accept-Encoding：浏览器可以处理的压缩编码类型。</li> <li>Accept-Language：浏览器使用的语言。</li> <li>Connection：浏览器与服务器的连接类型。</li> <li>Cookie：页面中设置的 Cookie。</li> <li>Host：发送请求的页面所在的域。</li> <li>Referer：发送请求的页面的 URI。注意，这个字段在 HTTP 规范中就拼错了，所以考虑到兼容性也必须将错就错。（正确的拼写应该是 Referrer。）</li> <li>User-Agent：浏览器的用户代理字符串。</li></ul> <p>setRequestHeader() 方法，发送额外的请求头部，接收两个参数：头部字段的名称和值。</p> <p>为保证请求头部被发送，必须在 open() 之后、send() 之前调用 setRequestHeader()</p> <p>getResponseHeader() 方法，从 XHR 对象获取响应头部，只要传入要获取头部的名称即可。</p> <p>getAllResponseHeaders() 方法，这个方法会返回包含所有响应头部的字符串。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> myHeader <span class="token operator">=</span> xhr<span class="token punctuation">.</span><span class="token function">getResponseHeader</span><span class="token punctuation">(</span><span class="token string">'MyHeader'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> allHeaders <span class="token operator">=</span> xhr<span class="token punctuation">.</span><span class="token function">getAllResponseHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_1-3-content-type"><a href="#_1-3-content-type" class="header-anchor">#</a> 1.3 Content-Type</h3> <p>请求参数有 3 种格式：</p> <p>（1）application/x-www-formurlencoded</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">'a=1&amp;b=2'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> contentType <span class="token operator">=</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">;</span>
ajax<span class="token punctuation">.</span><span class="token function">createRequest</span><span class="token punctuation">(</span>
  <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token string">'/api/user'</span><span class="token punctuation">,</span>
  str<span class="token punctuation">,</span>
  <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  contentType<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>（2）application/json</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> contentType <span class="token operator">=</span> <span class="token string">'application/json'</span><span class="token punctuation">;</span>
ajax<span class="token punctuation">.</span><span class="token function">createRequest</span><span class="token punctuation">(</span>
  <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token string">'/api/user'</span><span class="token punctuation">,</span>
  str<span class="token punctuation">,</span>
  <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  contentType<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>（3）multipart/form-data</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ajax<span class="token punctuation">.</span><span class="token function">createRequest</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'/api/user'</span><span class="token punctuation">,</span> formData<span class="token punctuation">,</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>XHR 对象能够识别作为 FormData 实例传入的数据类型并自动配置相应的头部。</p> <h3 id="_1-4-超时处理"><a href="#_1-4-超时处理" class="header-anchor">#</a> 1.4 超时处理</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token comment">// 设置 1 秒超时</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Request did not return in a second.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_1-5-overridemimetype"><a href="#_1-5-overridemimetype" class="header-anchor">#</a> 1.5 overrideMimeType()</h3> <p>overrideMimeType() 方法用于重写 XHR 响应的 MIME 类型。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'text.php'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">overrideMimeType</span><span class="token punctuation">(</span><span class="token string">'text/xml'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在 send() 之前调用</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_2、进度事件"><a href="#_2、进度事件" class="header-anchor">#</a> 2、进度事件</h2> <p>有以下 6 个进度相关的事件。</p> <ul><li>loadstart：在接收到响应的第一个字节时触发。</li> <li>progress：在接收响应期间反复触发。</li> <li>error：在请求出错时触发。</li> <li>abort：在调用 abort() 终止连接时触发。</li> <li>load：在成功接收完响应时触发。</li> <li>loadend：在通信完成时，且在 error、abort 或 load 之后触发。</li></ul> <h3 id="_2-1-load-事件"><a href="#_2-1-load-事件" class="header-anchor">#</a> 2.1 load 事件</h3> <p>load 事件在响应接收完成后立即触发，onload 事件处理程序会收到一个 event 对象，其 target 属性设置为 XHR 实例，在这个实例上可以访问所有 XHR 对象属性和方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Request was unsuccessful: '</span> <span class="token operator">+</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'altevents.php'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_2-2-progress-事件"><a href="#_2-2-progress-事件" class="header-anchor">#</a> 2.2 progress 事件</h3> <p>每次触发时，onprogress 事件处理程序都会收到 event 对象，其 target 属性是 XHR 对象，且包含 3 个额外属性 lengthComputable、position 和 totalSize。</p> <ul><li>lengthComputable 是一个布尔值，表示进度信息是否可用；</li> <li>position 是接收到的字节数；</li> <li>totalSize 是响应的 ContentLength 头部定义的总字节数。</li></ul> <h2 id="_3、跨源资源共享"><a href="#_3、跨源资源共享" class="header-anchor">#</a> 3、跨源资源共享</h2> <p>默认情况下，XHR 只能访问与发起请求的页面在同一个域内的资源。</p> <p>跨源资源共享（CORS，Cross-Origin Resource Sharing）定义了浏览器与服务器如何实现跨源通信。</p> <p>CORS 背后的基本思路就是使用自定义的 HTTP 头部允许浏览器和服务器相互了解，以确实请求或响应应该成功还是失败。</p> <p>对于简单的请求，比如 GET 或 POST 请求，没有自定义头部，而且请求体是 text/plain 类型，这样的请求在发送时会有一个额外的头部叫 Origin。Origin 头部包含发送请求的页面的源（协议、域名和端口），以便服务器确定是否为其提供响应。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Origin: http://www.nczonline.net
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果服务器决定响应请求，那么应该发送 Access-Control-Allow-Origin 头部，包含相同的源；或者如果资源是公开的，那么就包含&quot;*&quot;。比如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Access-Control-Allow-Origin: http://www.nczonline.net
Access-Control-Allow-Origin: *
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果没有这个头部，或者有但源不匹配，则表明不会响应浏览器请求。否则，服务器就会处理这个请求。注意，无论请求还是响应都不会包含 cookie 信息。</p> <p>现代浏览器通过 XMLHttpRequest 对象原生支持 CORS。在尝试访问不同源的资源时，这个行为会被自动触发。要向不同域的源发送请求，可以使用标准 XHR 对象并给 open() 方法传入一个绝对 URL</p> <p>跨域 XHR 对象允许访问 status 和 statusText 属性，也允许同步请求。出于安全考虑，跨域 XHR 对象也施加了一些额外限制。</p> <ul><li>不能使用 setRequestHeader()设置自定义头部。</li> <li>不能发送和接收 cookie。</li> <li>getAllResponseHeaders()方法始终返回空字符串。</li></ul> <h3 id="_3-1-预检请求"><a href="#_3-1-预检请求" class="header-anchor">#</a> 3.1 预检请求</h3> <p>CORS 通过一种叫预检请求（preflighted request）的服务器验证机制，允许使用自定义头部、除 GET 和 POST 之外的方法，以及不同请求体内容类型。在要发送涉及上述某种高级选项的请求时，会先向服务器发送一个“预检”请求。这个请求使用 OPTIONS 方法发送并包含以下头部</p> <ul><li>Origin：与简单请求相同。</li> <li>Access-Control-Request-Method：请求希望使用的方法。</li> <li>Access-Control-Request-Headers：（可选）要使用的逗号分隔的自定义头部列表。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>Origin: http://www.nczonline.net
Access-Control-Request-Method: POST
Access-Control-Request-Headers: NCZ
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在这个请求发送后，服务器可以确定是否允许这种类型的请求。服务器会通过在响应中发送如下头部与浏览器沟通这些信息。</p> <ul><li>Access-Control-Allow-Origin：与简单请求相同。</li> <li>Access-Control-Allow-Methods：允许的方法（逗号分隔的列表）。</li> <li>Access-Control-Allow-Headers：服务器允许的头部（逗号分隔的列表）。</li> <li>Access-Control-Max-Age：缓存预检请求的秒数。</li> <li></li></ul> <p>例如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Access-Control-Allow-Origin: http://www.nczonline.net
Access-Control-Allow-Methods: POST, GET
Access-Control-Allow-Headers: NCZ
Access-Control-Max-Age: 1728000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>预检请求返回后，结果会按响应指定的时间缓存一段时间。换句话说，只有第一次发送这种类型的请求时才会多发送一次额外的 HTTP 请求。</p> <h3 id="_3-2-凭据请求"><a href="#_3-2-凭据请求" class="header-anchor">#</a> 3.2 凭据请求</h3> <p>默认情况下，跨源请求不提供凭据（cookie、HTTP 认证和客户端 SSL 证书）。可以通过将
withCredentials 属性设置为 true 来表明请求会发送凭据。</p> <p>如果服务器允许带凭据的请求，那么可以在响应中包含如下 HTTP 头部：</p> <p><code>Access-Control-Allow-Credentials: true</code></p> <p>如果发送了凭据请求而服务器返回的响应中没有这个头部，则浏览器不会把响应交给 JavaScript（responseText 是空字符串，status 是 0，onerror()被调用）。注意，服务器也可以在预检请求的响应中发送这个 HTTP 头部，以表明这个源允许发送凭据请求。</p> <h2 id="_4、替代性跨源技术"><a href="#_4、替代性跨源技术" class="header-anchor">#</a> 4、替代性跨源技术</h2> <p>CORS 出现之前，实现跨源 Ajax 通信是有点麻烦的。开发者需要依赖能够执行跨源请求的 DOM 特性，在不使用 XHR 对象情况下发送某种类型的请求。虽然 CORS 目前已经得到广泛支持，但这些技术仍然没有过时，因为它们不需要修改服务器。</p> <h3 id="_4-1-图片探测"><a href="#_4-1-图片探测" class="header-anchor">#</a> 4.1 图片探测</h3> <p>图片探测是利用<code>&lt;img&gt;</code>标签实现跨域通信的最早的一种技术。任何页面都可以跨域加载图片而不必担心限制，因此这也是在线广告跟踪的主要方式。可以动态创建图片，然后通过它们的 onload 和 onerror 事件处理程序得知何时收到响应。</p> <p>这种动态创建图片的技术经常用于图片探测（image pings）。图片探测是与服务器之间简单、跨域、单向的通信。数据通过查询字符串发送，响应可以随意设置，不过一般是位图图片或值为 204 的状态码。浏览器通过图片探测拿不到任何数据，但可以通过监听 onload 和 onerror 事件知道什么时候能接收到响应。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>onload <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Done!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'http://www.example.com/test?name=Nicholas'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>设置完 src 属性之后请求就开始了，这个例子向服务器发送了一个 name 值。</p> <p>图片探测频繁用于跟踪用户在页面上的点击操作或动态显示广告。当然，图片探测的缺点是只能发送 GET 请求和无法获取服务器响应的内容。这也是只能利用图片探测实现浏览器与服务器单向通信的原因。</p> <h3 id="_4-2-jsonp"><a href="#_4-2-jsonp" class="header-anchor">#</a> 4.2 JSONP</h3> <p>JSONP 是“JSON with padding”的简写，是在 Web 服务上流行的一种 JSON 变体。JSONP 看起来跟 JSON 一样，只是会被包在一个函数调用里，比如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Nicholas'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 服务器返回格式必须包含回调方法名</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>JSONP 格式包含两个部分：回调和数据。回调是在页面接收到响应之后应该调用的函数，通常回调函数的名称是通过请求来动态指定的。而数据就是作为参数传给回调函数的 JSON 数据。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'send'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span>
    <span class="token string">'http://10.10.9.1:8888/api/userInfor/companyList2?callback=handleResponse'</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>script<span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="_5、fetch-api"><a href="#_5、fetch-api" class="header-anchor">#</a> 5、Fetch API</h2> <p>Fetch API 能够执行 XMLHttpRequest 对象的所有任务，但更容易使用，接口也更现代化，能够在 Web 工作线程等现代 Web 工具中使用。XMLHttpRequest 可以选择异步，而 Fetch API 则必须是异步。</p> <p>Fetch API 本身是使用 JavaScript 请求资源的优秀工具，同时这个 API 也能够应用在服务线程（service worker）中，提供拦截、重定向和修改通过 fetch() 生成的请求接口。</p> <h3 id="_5-1-基本用法"><a href="#_5-1-基本用法" class="header-anchor">#</a> 5.1 基本用法</h3> <p><code>function fetch(input: RequestInfo, init?: RequestInit): Promise&lt;Response&gt;</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> r <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">text</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>两个参数：</p> <ul><li>input，要获取资源的 URL</li> <li>init，传入的配置对象，包含 body、headers、method 等信息</li></ul> <h3 id="_5-2-常见-fetch-请求模式"><a href="#_5-2-常见-fetch-请求模式" class="header-anchor">#</a> 5.2 常见 Fetch 请求模式</h3> <p>与 XMLHttpRequest 一样，fetch() 既可以发送数据也可以接收数据。使用 init 对象参数，可以配置 fetch() 在请求体中发送各种序列化的数据。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 发送 json 数据</span>
<span class="token keyword">const</span> init <span class="token operator">=</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token comment">// 发送请求体时必须使用一种 HTTP 方法</span>
  body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  headers<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 发送参数</span>
<span class="token keyword">const</span> init <span class="token operator">=</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  body<span class="token operator">:</span> <span class="token string">'foo=bar&amp;baz=qux'</span><span class="token punctuation">,</span>
  headers<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded; charset=UTF-8'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 发送FormData（支持发送文件）</span>
<span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> inputFile <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;input[type='file']&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> inputFile<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token string">'111'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> init <span class="token operator">=</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  body<span class="token operator">:</span> formData<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 调用</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/user'</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">text</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 加载 blob</span>
<span class="token keyword">const</span> imageElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'my-image.png'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">blob</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    imageElement<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 发送跨源请求</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'//cross-origin.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 响应要包含 CORS 头部才能保证浏览器收到响应。</span>
<span class="token comment">// TypeError: Failed to fetch</span>
<span class="token comment">// No 'Access-Control-Allow-Origin' header is present on the requested resource.</span>

<span class="token comment">// 发送探测请求</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'//cross-origin.com'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> method<span class="token operator">:</span> <span class="token string">'no-cors'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// opaque</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>中断请求：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> abortController <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'wikipedia.zip'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> signal<span class="token operator">:</span> abortController<span class="token punctuation">.</span>signal <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'aborted!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 10 毫秒后中断请求</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> abortController<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 已经中断</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_5-3-headers-对象"><a href="#_5-3-headers-对象" class="header-anchor">#</a> 5.3 Headers 对象</h3> <p>Headers 对象是所有外发请求和入站响应头部的容器。每个外发的 Request 实例都包含一个空的 Headers 实例，可以通过 Request.prototype.headers 访问，每个入站 Response 实例也可以通过 Response.prototype.headers 访问包含着响应头部的 Headers 对象。这两个属性都是可修改属性。另外，使用 new Headers() 也可以创建一个新实例。</p> <p>（1）Headers 与 Map 的相似之处</p> <p>Headers 与 Map 类型都有 get()、set()、has() 和 delete() 等实例方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置键</span>
h<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Headers 和 Map 都可以使用一个可迭代对象来初始化</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> seed <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bar</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bar</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>而且，它们也都有相同的 keys()、values() 和 entries() 迭代器接口：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> seed <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'baz'</span><span class="token punctuation">,</span> <span class="token string">'qux'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">...</span>h<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo, baz</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">...</span>m<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo, baz</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>（2）Headers 独有的特性</p> <p>在初始化 Headers 对象时，也可以使用键/值对形式的对象</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> seed <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bar</span>
<span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// TypeError: object is not iterable</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>一个 HTTP 头部字段可以有多个值，而 Headers 对象通过 append() 方法支持添加多个值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
h<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;bar&quot;</span>
h<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;bar, baz&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>某些情况下，并非所有 HTTP 头部都可以被客户端修改，而 Headers 对象使用护卫来防止不被允许的修改。不同的护卫设置会改变 set()、append()和 delete()的行为。违反护卫限制会抛出 TypeError。</p> <h3 id="_5-4-request-对象"><a href="#_5-4-request-对象" class="header-anchor">#</a> 5.4 Request 对象</h3> <p>Request 对象是获取资源请求的接口。这个接口暴露了请求的相关信息，也暴露了使用请求体的不同方式。</p> <p>（1）创建 Request 对象</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'https://foo.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Request {...}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Request 构造函数也接收第二个参数——一个 init 对象。这个 init 对象与前面介绍的 fetch() 的 init 对象一样。没有在 init 对象中涉及的值则会使用默认值。</p> <p>（2）克隆 Request 对象</p> <p>Fetch API 提供了两种方式用于创建 Request 对象的副本：使用 Request 构造函数和使用 clone() 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'https://foo.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r2<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// https://foo.com/</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r1<span class="token punctuation">.</span>bodyUsed<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true 已使用</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r2<span class="token punctuation">.</span>bodyUsed<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>

<span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'https://foo.com'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> body<span class="token operator">:</span> <span class="token string">'foobar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> r2 <span class="token operator">=</span> r1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r1<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// https://foo.com/</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r2<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// https://foo.com/</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r1<span class="token punctuation">.</span>bodyUsed<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r2<span class="token punctuation">.</span>bodyUsed<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>这种克隆方式并不总能得到一模一样的副本。最明显的是，第一个请求的请求体会被标记为“已使用”</p> <p>多次调用 Request</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'https://foo.com'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> body<span class="token operator">:</span> <span class="token string">'foobar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// TypeError: Cannot construct a Request with a Request object that has already been used.</span>

<span class="token comment">// 使用 clone</span>
<span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token string">'https://foo.com'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> body<span class="token operator">:</span> <span class="token string">'foobar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 3 个都会成功</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_5-5-response-对象"><a href="#_5-5-response-对象" class="header-anchor">#</a> 5.5 Response 对象</h3> <p>Response 对象是获取资源响应的接口。这个接口暴露了响应的相关信息，也暴露了使用响应体的不同方式。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_5-6-body"><a href="#_5-6-body" class="header-anchor">#</a> 5.6 body</h3> <p>body 提供了五个方法：</p> <ul><li><code>body.text()</code> 方法返回 UTF-8 格式字符串</li> <li><code>body.json()</code> 方法返回 JSON</li> <li><code>body.formData()</code> 方法返回 FormData 实例</li> <li><code>body.arrayBuffer()</code> 方法返回 ArrayBuffer 实例</li> <li><code>body.blob()</code> 方法返回 Blob 实例</li></ul> <h2 id="_6、beacon-api"><a href="#_6、beacon-api" class="header-anchor">#</a> 6、Beacon API</h2> <p>在 unload 事件触发时，分析工具要停止收集信息并把收集到的数据发给服务器。这时候有一个问题，因为 unload 事件对浏览器意味着没有理由再发送任何结果未知的网络请求（因为页面都要被销毁了）。例如，在 unload 事件处理程序中创建的任何异步请求都会被浏览器取消。为此，异步 XMLHttpRequest 或 fetch()不适合这个任务。分析工具可以使用同步 XMLHttpRequest 强制发送请求，但这样做会导致用户体验问题。浏览器会因为要等待 unload 事件处理程序完成而延迟导航到下一个页面。</p> <p>W3C 引入了补充性的 Beacon API。这个 API 给 navigator 对象增加了一个 sendBeacon() 方法。这个简单的方法接收一个 URL 和一个数据有效载荷参数，并会发送一个 POST 请求。可选的数据有效载荷参数有 ArrayBufferView、Blob、DOMString、FormData 实例。如果请求成功进入了最终要发送的任务队列，则这个方法返回 true，否则返回 false。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 发送 POST 请求</span>
<span class="token comment">// URL: 'https://example.com/analytics-reporting-url'</span>
<span class="token comment">// 请求负载：'{foo: &quot;bar&quot;}'</span>
navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span>
  <span class="token string">'https://example.com/analytics-reporting-url'</span><span class="token punctuation">,</span>
  <span class="token string">'{foo: &quot;bar&quot;}'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>sendBeacon() 方法特性：</p> <ul><li>sendBeacon() 并不是只能在页面生命周期末尾使用，而是任何时候都可以使用。</li> <li>调用 sendBeacon() 后，浏览器会把请求添加到一个内部的请求队列。浏览器会主动地发送队列中的请求。</li> <li>浏览器保证在原始页面已经关闭的情况下也会发送请求。</li> <li>状态码、超时和其他网络原因造成的失败完全是不透明的，不能通过编程方式处理。</li> <li>信标（beacon）请求会携带调用 sendBeacon() 时所有相关的 cookie。</li></ul> <h2 id="_7、web-socket"><a href="#_7、web-socket" class="header-anchor">#</a> 7、Web Socket</h2> <p>Web Socket（套接字）的目标是通过一个长时连接实现与服务器全双工、双向的通信。</p> <p>在 JavaScript 中创建 Web Socket 时，一个 HTTP 请求会发送到服务器以初始化连接。服务器响应后，连接使用 HTTP 的 Upgrade 头部从 HTTP 协议切换到 Web Socket 协议。</p> <p>因为 Web Socket 使用了自定义协议，所以 URL 方案（scheme）稍有变化：不能再使用 http:// 或 https://，而要使用 ws:// 和 wss://。前者是不安全的连接，后者是安全连接。</p> <p>封装WebSocket：<a href="/blog/web/node/Websocket示例.html">传送门</a></p> <h3 id="_7-1-api"><a href="#_7-1-api" class="header-anchor">#</a> 7.1 API</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://www.example.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>浏览器会在初始化 WebSocket 对象之后立即创建连接。与 XHR 类似，WebSocket 也有一个 readyState 属性表示当前状态。不过，这个值与 XHR 中相应的值不一样。</p> <ul><li>WebSocket.OPENING（0）：连接正在建立。</li> <li>WebSocket.OPEN（1）：连接已经建立。</li> <li>WebSocket.CLOSING（2）：连接正在关闭。</li> <li>WebSocket.CLOSE（3）：连接已经关闭。</li></ul> <p>WebSocket 对象没有 readystatechange 事件，而是有与上述不同状态对应的其他事件。readyState 值从 0 开始。</p> <p>任何时候都可以调用 close() 方法关闭 Web Socket 连接：<code>socket.close();</code></p> <p>调用 close() 之后，readyState 立即变为 2（连接正在关闭），并会在关闭后变为 3（连接已经关闭）。</p> <h3 id="_7-2-发送和接收数据"><a href="#_7-2-发送和接收数据" class="header-anchor">#</a> 7.2 发送和接收数据</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://www.example.com/server.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 发送数据</span>
<span class="token keyword">let</span> stringData <span class="token operator">=</span> <span class="token string">'Hello world!'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arrayBufferData <span class="token operator">=</span> Uint8Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> blobData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>stringData<span class="token punctuation">)</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>arrayBufferData<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>blobData<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 接收数据</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
 <span class="token keyword">let</span> data <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span> 
 <span class="token comment">// 对数据执行某些操作</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_7-3-其他事件"><a href="#_7-3-其他事件" class="header-anchor">#</a> 7.3 其他事件</h3> <p>WebSocket 对象在连接生命周期中有可能触发 3 个其他事件。</p> <ul><li>open：在连接成功建立时触发。</li> <li>error：在发生错误时触发。连接无法存续。</li> <li>close：在连接关闭时触发。</li></ul> <h2 id="_8、安全"><a href="#_8、安全" class="header-anchor">#</a> 8、安全</h2> <p>在未授权系统可以访问某个资源时，可以将其视为跨站点请求伪造（CSRF，cross-site request forgery）攻击。未授权系统会按照处理请求的服务器的要求伪装自己。Ajax 应用程序，无论大小，都会受到 CSRF攻击的影响，包括无害的漏洞验证攻击和恶意的数据盗窃或数据破坏攻击。</p> <p>关于安全防护 Ajax 相关 URL 的一般理论认为，需要验证请求发送者拥有对资源的访问权限。可以通过如下方式实现。</p> <ul><li>要求通过 SSL 访问能够被 Ajax 访问的资源。</li> <li>要求每个请求都发送一个按约定算法计算好的令牌（token）。</li></ul> <p>注意，以下手段对防护 CSRF 攻击是无效的。</p> <ul><li>要求 POST 而非 GET 请求（很容易修改请求方法）。</li> <li>使用来源 URL 验证来源（来源 URL 很容易伪造）。</li> <li>基于 cookie 验证（同样很容易伪造）。</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/web/javascript/12.2-处理JSON.html" class="prev">
        12.2-处理JSON
      </a></span> <span class="next"><a href="/blog/web/javascript/14-客户端存储.html">
        14-客户端存储
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div></div></div></div>
    <script src="/blog/assets/js/app.3f235546.js" defer></script><script src="/blog/assets/js/2.ea2cf60a.js" defer></script><script src="/blog/assets/js/53.840e5bc7.js" defer></script>
  </body>
</html>
