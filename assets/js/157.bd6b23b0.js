(window.webpackJsonp=window.webpackJsonp||[]).push([[157],{472:function(s,t,e){"use strict";e.r(t);var a=e(10),n=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"配置环境变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置环境变量"}},[s._v("#")]),s._v(" 配置环境变量")]),s._v(" "),t("h2",{attrs:{id:"_1、vue2-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、vue2-配置"}},[s._v("#")]),s._v(" 1、vue2 配置")]),s._v(" "),t("p",[s._v("在项目根目录创建三个文件："),t("code",[s._v(".env.dev")]),s._v("、"),t("code",[s._v("env.prod")]),s._v("、"),t("code",[s._v("env.test")])]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v(".env.dev")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("NODE_ENV = development\nVUE_APP_ENV = development\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("blockquote",[t("p",[t("code",[s._v(".env.prod")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("NODE_ENV = production\nVUE_APP_ENV = production\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("blockquote",[t("p",[t("code",[s._v(".env.test")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("NODE_ENV = test\nVUE_APP_ENV = test\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("然后可以使用 process.env 方式获取")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VUE_APP_ENV")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" process"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE_ENV")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("参考"),t("a",{attrs:{href:"https://cli.vuejs.org/zh/guide/mode-and-env.html#%E6%A8%A1%E5%BC%8F",target:"_blank",rel:"noopener noreferrer"}},[s._v("vue cli3 模式和环境变量"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"_2、vue3-方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、vue3-方式"}},[s._v("#")]),s._v(" 2、vue3 方式")]),s._v(" "),t("p",[s._v("因为 vue3 使用 vite 打包，可以使用 vite 的 API 获取。")]),s._v(" "),t("p",[s._v("vite 在一个特殊的 "),t("code",[s._v("import.meta.env")]),s._v(" 对象上暴露环境变量。这里有一些在所有情况下都可以使用的内建变量：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("import.meta.env.MODE")]),s._v(": {string} 应用运行的模式。")]),s._v(" "),t("li",[t("code",[s._v("import.meta.env.BASE_URL")]),s._v(": {string} 部署应用时的基本 URL。他由base 配置项决定。")]),s._v(" "),t("li",[t("code",[s._v("import.meta.env.PROD")]),s._v(": {boolean} 应用是否运行在生产环境。")]),s._v(" "),t("li",[t("code",[s._v("import.meta.env.DEV")]),s._v(": {boolean} 应用是否运行在开发环境 (永远与 import.meta.env.PROD相反)。")]),s._v(" "),t("li",[t("code",[s._v("import.meta.env.SSR")]),s._v(": {boolean} 应用是否运行在 server 上。")])]),s._v(" "),t("h3",{attrs:{id:"_2-1-env-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-env-文件"}},[s._v("#")]),s._v(" 2.1 .env 文件")]),s._v(" "),t("p",[s._v("在环境目录中的下列文件加载额外的环境变量：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v(".env                # 所有情况下都会加载\n.env.local          # 所有情况下都会加载，但会被 git 忽略\n.env.[mode]         # 只在指定模式下加载\n.env.[mode].local   # 只在指定模式下加载，但会被 git 忽略\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("blockquote",[t("p",[s._v("环境加载优先级")])]),s._v(" "),t("p",[s._v("一份用于指定模式的文件（例如 .env.production）会比通用形式的优先级更高（例如 .env）。另外，Vite 执行时已经存在的环境变量有最高的优先级，不会被 .env 类文件覆盖。例如当运行 VITE_SOME_KEY=123 vite build 的时候。")]),s._v(" "),t("p",[s._v(".env 类文件会在 Vite 启动一开始时被加载，而改动会在重启服务器后生效。")]),s._v(" "),t("p",[s._v("加载的环境变量也会通过 "),t("code",[s._v("import.meta.env")]),s._v(" 以字符串形式暴露给客户端源码。")]),s._v(" "),t("p",[s._v("为了防止意外地将一些环境变量泄漏到客户端，只有以 "),t("code",[s._v("VITE_")]),s._v(" 为前缀的变量才会暴露给经过 vite 处理的代码。例如下面这些环境变量：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("VITE_SOME_KEY=123\nDB_PASSWORD=foobar\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("meta"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VITE_SOME_KEY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 123")]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("meta"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DB_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// undefined")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"_2-2-typescript-的智能提示"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-typescript-的智能提示"}},[s._v("#")]),s._v(" 2.2 TypeScript 的智能提示")]),s._v(" "),t("p",[s._v("默认情况下，Vite 在 "),t("a",{attrs:{href:"https://github.com/vitejs/vite/blob/main/packages/vite/client.d.ts",target:"_blank",rel:"noopener noreferrer"}},[s._v("vite/client.d.ts"),t("OutboundLink")],1),s._v(" 中为 "),t("code",[s._v("import.meta.env")]),s._v(" 提供了类型定义。随着在 "),t("code",[s._v(".env[mode]")]),s._v(" 文件中自定义了越来越多的环境变量，你可能想要在代码中获取这些以 "),t("code",[s._v("VITE_")]),s._v(" 为前缀的用户自定义环境变量的 TypeScript 智能提示。")]),s._v(" "),t("p",[s._v("要想做到这一点，你可以在 src 目录下创建一个 "),t("code",[s._v("env.d.ts")]),s._v(" 文件，接着按下面这样增加 "),t("code",[s._v("ImportMetaEnv")]),s._v(" 的定义：")]),s._v(" "),t("div",{staticClass:"language-ts line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ts"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('/// <reference types="vite/client" />')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ImportMetaEnv")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("readonly")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VITE_APP_TITLE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 更多环境变量...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ImportMeta")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("readonly")]),s._v(" env"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ImportMetaEnv\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("如果你的代码依赖于浏览器环境的类型，比如 DOM 和 WebWorker，你可以在 tsconfig.json 中修改 lib 字段来获取类型支持。")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"lib"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"WebWorker"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("参考"),t("a",{attrs:{href:"https://cn.vitejs.dev/guide/env-and-mode.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("vite 环境变量和模式"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=n.exports}}]);